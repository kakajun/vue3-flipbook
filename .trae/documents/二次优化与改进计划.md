## 目标
- 在你已升级到最新依赖的基础上，完成 Storybook 主版本升级（至 8 或 10），并保证与现有 Vite/Vue3 项目及常用插件的兼容。

## Storybook 升级路线
- 版本选择：
  - 优先 8.x（迁移成本较低），如需 10.x 则继续按官方迁移指南补充变更。
- 核心包替换：
  - `storybook` CLI 升级 → `npx storybook@latest upgrade`
  - 框架：`@storybook/vue3-vite` 升级到对应主版本；`@storybook/vue3`（若使用）保持与框架一致。
- Builder/运行：
  - 保持 Vite Builder；校验 `vite.config.ts`（别名、测试环境、base）与新版兼容。

## 配置与文件迁移（main/preview）
- `main.ts`（Terminal#8-28 对应 addons 列表）：
  - 保留：`@storybook/addon-links`、`@storybook/addon-essentials`、`@storybook/addon-interactions`。
  - 处理：`@storybook/addon-storysource` 在新版 Docs/Source Blocks 已内置或迁移为 `@storybook/addon-docs`；按新版指南替换或移除。
  - 审核：`@storybook/blocks` 使用范围（Docs 页面）与版本一致性。
  - `stories` 匹配更新：统一到 `../src/**/*.stories.@(js|jsx|mjs|ts|tsx)`，移除 `.mdx` 或按需迁移 MDX（Docs 新写法）。
- `preview.ts`：
  - 保留全局 `layout: 'centered'` 与 Decorator 居中包裹；
  - 如升级到 10.x，校验参数键名与 Docs 布局 API 是否变更。

## 插件兼容处理
- `@storybook/addon-styling`：其 peer 依赖提示 webpack（在 Vite builder 下非必须）。处理方式：
  - 若不需要该 addon 的特定功能，建议移除以清理 peer 警告；
  - 若需要，补装 `postcss/less` 并评估是否确实需要 webpack 生态（不推荐与 Vite 并存）。
- 测试集成：升级 `@storybook/test` 与 `@storybook/testing-library` 到与目标主版本一致；
  - 校验 Vitest 与 JSDOM 版本兼容；
  - 在 Stories 中维持测试 Loader/Render 写法的兼容性。

## 与现有依赖的适配
- Vite/Vue3：
  - 保持 `@vitejs/plugin-vue` 与 Vite 主版本匹配；
  - `vue-router`、`pinia` 与 Vue3 版本兼容性检查（已升级到最新版时通常兼容）。
- 样式与资源：
  - CSS 路径统一为 `vue3-flipbook/dist/vue3-flipbook.css`，Docs/Canvas 一致。
- Node 版本：
  - 设置 `engines.node >= 18`，避免新版 Storybook/Vite 在旧 Node 下抛错。

## 验证与回归
- 运行 `storybook` 并检查：
  - 管理器/预览正常启动，无红色错误；
  - “Flip Demo”“Slow One”“FlipPerf”能加载并交互正常；
  - 控制台无 rematrix 维度错误、无 CSS 解析错误、无 peer 依赖警告（或明确可忽略的）。
- 测试：
  - Vitest 用例通过；
  - `@storybook/test` 行为测试对翻页/缩放进行端到端验证。

## 回滚与分支
- 新建迁移分支（如 `feat/storybook-upgrade`），完成迁移后合入主干；如遇到 Docs 行为变更影响较大，保留 7.x 的回滚点。

## 交付项
- 升级后的 `main.ts/preview.ts` 兼容配置；
- 插件依赖清理/替换（特别是 `addon-styling`）；
- 运行与测试验证记录（含关键页面的截图或性能指标）。