import{d as Et,b as f,r as Xt,e as g,o as Yt,f as Zt,w as V,g as ae,j as le,k as Wt,n as qt,l as Ht,u as P,m as X,p as C,q as et,F as Vt,s as Ut,t as tt,v as Jt,x as Kt,y as lt}from"./vue.esm-bundler-DgLHvA7G.js";var Qt=Object.defineProperty,Gt=(a,e,t)=>e in a?Qt(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,eo=(a,e,t)=>(Gt(a,typeof e!="symbol"?e+"":e,t),t);/*! @license Rematrix v0.7.2

	Copyright 2021 Julian Lloyd.

	Permission is hereby granted, free of charge, to any person obtaining a copy
	of this software and associated documentation files (the "Software"), to deal
	in the Software without restriction, including without limitation the rights
	to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
	copies of the Software, and to permit persons to whom the Software is
	furnished to do so, subject to the following conditions:

	The above copyright notice and this permission notice shall be included in
	all copies or substantial portions of the Software.

	THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
	IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
	FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
	AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
	LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
	OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
	THE SOFTWARE.
*/function $e(a){if(a&&a.constructor===Array){var e=a.filter(function(r){return typeof r=="number"}).filter(function(r){return!isNaN(r)});if(a.length===6&&e.length===6){var t=U();return t[0]=e[0],t[1]=e[1],t[4]=e[2],t[5]=e[3],t[12]=e[4],t[13]=e[5],t}else if(a.length===16&&e.length===16)return a}throw new TypeError("Expected a `number[]` with length 6 or 16.")}function U(){for(var a=[],e=0;e<16;e++)e%5==0?a.push(1):a.push(0);return a}function to(a,e){for(var t=$e(a),r=$e(e),o=[],n=0;n<4;n++)for(var i=[t[n],t[n+4],t[n+8],t[n+12]],s=0;s<4;s++){var u=s*4,d=[r[u],r[u+1],r[u+2],r[u+3]],b=i[0]*d[0]+i[1]*d[1]+i[2]*d[2]+i[3]*d[3];o[n+u]=b}return o}function oo(a){var e=U();return e[11]=-1/a,e}function ao(a){var e=Math.PI/180*a,t=U();return t[0]=t[10]=Math.cos(e),t[2]=t[8]=Math.sin(e),t[2]*=-1,t}function lo(a){return"matrix3d("+$e(a).join(", ")+")"}function ro(a,e){var t=U();return t[12]=a,e&&(t[13]=e),t}function so(a,e,t){var r=U();return a!==void 0&&e!==void 0&&t!==void 0&&(r[12]=a,r[13]=e,r[14]=t),r}class Ne{constructor(e){eo(this,"m"),e?this.m=[...e]:this.m=U()}clone(){return new Ne(this.m)}multiply(e){this.m=to(this.m,e)}perspective(e){this.multiply(oo(e))}transformX(e){return(e*this.m[0]+this.m[12])/(e*this.m[3]+this.m[15])}translate(e,t){this.multiply(ro(e,t))}translate3d(e,t,r){this.multiply(so(e,t,r))}rotateY(e){this.multiply(ao(e))}toString(){return lo(this.m)}}const no=(a,e,t)=>{let r=0;return a>.5&&(r=-(a-.5)*2*180),e==="left"&&(r=-r),t==="back"&&(r+=180),r},rt=a=>Math.pow(a,2),uo=a=>1-rt(1-a),st=a=>a<.5?rt(a*2)/2:.5+uo((a-.5)*2)/2,io=(a,e,t,r,o,n,i)=>{let s=t,u=!1;return r===1?o==="right"?a==="back"&&(u=!0,s=t-n):e==="left"?a==="back"?s=n-t:u=!0:a==="front"?s=n-t:u=!0:e==="left"?a==="back"?s=i/2:u=!0:a==="front"?s=i/2:u=!0,{pageX:s,originRight:u}},vo=(a,e,t,r,o,n,i)=>{const s=new Ne;return s.translate(r/2),s.perspective(o),s.translate(-r/2),s.translate(a,n),t&&(e&&s.translate(i),s.rotateY(t),e&&s.translate(-i)),s},po=(a,e)=>{let t;a<.5?t=a*2*Math.PI:t=(1-(a-.5)*2)*Math.PI,t==0&&(t=1e-9);const r=e/t;return{theta:t,radius:r}},co=(a,e,t)=>t?-a/Math.PI*180+e/2/Math.PI*180:e/2/Math.PI*180,go=(a,e,t,r)=>{const o=[],n=[-.5,-.25,0,.25,.5];if(t<1){const i=1-t,s=n.map(u=>(1-Math.cos((a-e*u)/180*Math.PI))*i);o.push(`linear-gradient(to right, rgba(0, 0, 0, ${s[0]}), rgba(0, 0, 0, ${s[1]}) 25%, rgba(0, 0, 0, ${s[2]}) 50%, rgba(0, 0, 0, ${s[3]}) 75%, rgba(0, 0, 0, ${s[4]}))`)}if(r>0){const i=n.map(s=>Math.max(Math.cos((a+30-e*s)/180*Math.PI)**200,Math.cos((a-30-e*s)/180*Math.PI)**200));o.push(`linear-gradient(to right, rgba(255, 255, 255, ${i[0]*r}), rgba(255, 255, 255, ${i[1]*r}) 25%, rgba(255, 255, 255, ${i[2]*r}) 50%, rgba(255, 255, 255, ${i[3]*r}) 75%, rgba(255, 255, 255, ${i[4]*r}))`)}return o.join(",")},ho=(a,e,t,r,o)=>{let n=Math.sin(a)*e;t&&(n=o-n);let i=(1-Math.cos(a))*e;return r==="back"&&(i=-i),{x:n,z:i}};function fo(a,e){const t=lt();if(!t)throw new Error("useDrawer() can only be used inside setup() or functional components!");const r=t.props,o=f(1);let n=0;const i=f(!1),s=f(0),u=f(0),d=c=>{m.value&&(n+=1,r.zooms&&F(r.zooms[n],c))},b=c=>{_.value&&(n-=1,r.zooms&&F(r.zooms[n],c))},F=(c,L)=>{const z=a==null?void 0:a.value;if(z){let $,k;if(L){const Z=z.getBoundingClientRect();$=L.pageX-Z.left,k=L.pageY-Z.top}else $=z.clientWidth/2,k=z.clientHeight/2;const p=o.value,I=c,Y=z.scrollLeft,W=z.scrollTop,re=$+Y,J=k+W,y=re/p*I-$,K=J/p*I-k,se=Date.now();i.value=!0,t==null||t.emit("zoom-start",c);const Q=()=>{requestAnimationFrame(()=>{const Z=Date.now()-se;let O=Z/r.zoomDuration;O=O>1?1:O,O=st(O),o.value=p+(I-p)*O,s.value=Y+(y-Y)*O,u.value=W+(K-W)*O,Z<r.zoomDuration?Q():(t==null||t.emit("zoom-end",c),i.value=!1,o.value=c,s.value=y,u.value=K)})};Q(),I>1&&e(!0)}},j=c=>{n=(n+1)%r.zooms.length,F(r.zooms[n],c)},m=g(()=>!i.value&&n<r.zooms.length-1),_=g(()=>!i.value&&n>0);return{zoom:o,zooming:i,canZoomIn:m,canZoomOut:_,zoomIn:d,zoomOut:b,zoomAt:j,onWheel:(c,L)=>{r.wheel==="scroll"&&o.value>1&&!L&&a.value&&(s.value=a.value.scrollLeft+c.deltaX,u.value=a.value.scrollTop+c.deltaY,c.cancelable&&c.preventDefault()),r.wheel==="zoom"&&(c.deltaY>=100?(b(c),c.preventDefault()):c.deltaY<=-100&&(d(c),c.preventDefault()))},scrollLeft:s,scrollTop:u}}function mo(a,e,t){const r=f({}),o=f(0),n=f(0),i=f(),s=f(null),u=f(null),d=lt();if(!d)throw new Error("useDrawer() can only be used inside setup() or functional components!");const b=d.props,F=(m,_=!1)=>{var c,L;return m<1?"":_&&e.value>1&&!t.value?(m<b.pagesHiRes.length?(c=b.pagesHiRes)==null?void 0:c[m]:"")||"":(m<b.pages.length?(L=b.pages)==null?void 0:L[m]:"")||""},j=m=>{if(s.value===null||r.value[m])return m;{const _=new Image;return _.onload=()=>{r.value[m]=!0},_.src=m,b.loadingImage||""}};return{imageWidth:s,imageHeight:u,pageUrl:F,loadImage:j,pageUrlLoading:(m,_=!1)=>{const c=F(m,_);return _&&e.value>1&&!t.value?c:c&&j(c)},didLoadImage:m=>{s.value===null&&(s.value=m.target.naturalWidth,u.value=m.target.naturalHeight,a()),i.value&&(++o.value>=n.value&&i.value(),i.value=void 0)}}}const D={silent:Number.NEGATIVE_INFINITY,fatal:0,error:0,warn:1,log:2,info:3,success:3,fail:3,ready:3,start:3,box:3,debug:4,trace:5,verbose:Number.POSITIVE_INFINITY},ot={silent:{level:-1},fatal:{level:D.fatal},error:{level:D.error},warn:{level:D.warn},log:{level:D.log},info:{level:D.info},success:{level:D.success},fail:{level:D.fail},ready:{level:D.info},start:{level:D.info},box:{level:D.info},debug:{level:D.debug},trace:{level:D.trace},verbose:{level:D.verbose}};function Pe(a){return a!==null&&typeof a=="object"}function Se(a,e,t=".",r){if(!Pe(e))return Se(a,{},t,r);const o=Object.assign({},e);for(const n in a){if(n==="__proto__"||n==="constructor")continue;const i=a[n];i!=null&&(r&&r(o,n,i,t)||(Array.isArray(i)&&Array.isArray(o[n])?o[n]=[...i,...o[n]]:Pe(i)&&Pe(o[n])?o[n]=Se(i,o[n],(t?`${t}.`:"")+n.toString(),r):o[n]=i))}return o}function yo(a){return(...e)=>e.reduce((t,r)=>Se(t,r,"",a),{})}const wo=yo();function bo(a){return Object.prototype.toString.call(a)==="[object Object]"}function _o(a){return!(!bo(a)||!a.message&&!a.args||a.stack)}let De=!1;const at=[];class M{constructor(e={}){const t=e.types||ot;this.options=wo({...e,defaults:{...e.defaults},level:Fe(e.level,t),reporters:[...e.reporters||[]]},{types:ot,throttle:1e3,throttleMin:5,formatOptions:{date:!0,colors:!1,compact:!0}});for(const r in t){const o={type:r,...this.options.defaults,...t[r]};this[r]=this._wrapLogFn(o),this[r].raw=this._wrapLogFn(o,!0)}this.options.mockFn&&this.mockTypes(),this._lastLog={}}get level(){return this.options.level}set level(e){this.options.level=Fe(e,this.options.types,this.options.level)}prompt(e,t){if(!this.options.prompt)throw new Error("prompt is not supported!");return this.options.prompt(e,t)}create(e){const t=new M({...this.options,...e});return this._mockFn&&t.mockTypes(this._mockFn),t}withDefaults(e){return this.create({...this.options,defaults:{...this.options.defaults,...e}})}withTag(e){return this.withDefaults({tag:this.options.defaults.tag?this.options.defaults.tag+":"+e:e})}addReporter(e){return this.options.reporters.push(e),this}removeReporter(e){if(e){const t=this.options.reporters.indexOf(e);if(t>=0)return this.options.reporters.splice(t,1)}else this.options.reporters.splice(0);return this}setReporters(e){return this.options.reporters=Array.isArray(e)?e:[e],this}wrapAll(){this.wrapConsole(),this.wrapStd()}restoreAll(){this.restoreConsole(),this.restoreStd()}wrapConsole(){for(const e in this.options.types)console["__"+e]||(console["__"+e]=console[e]),console[e]=this[e].raw}restoreConsole(){for(const e in this.options.types)console["__"+e]&&(console[e]=console["__"+e],delete console["__"+e])}wrapStd(){this._wrapStream(this.options.stdout,"log"),this._wrapStream(this.options.stderr,"log")}_wrapStream(e,t){e&&(e.__write||(e.__write=e.write),e.write=r=>{this[t].raw(String(r).trim())})}restoreStd(){this._restoreStream(this.options.stdout),this._restoreStream(this.options.stderr)}_restoreStream(e){e&&e.__write&&(e.write=e.__write,delete e.__write)}pauseLogs(){De=!0}resumeLogs(){De=!1;const e=at.splice(0);for(const t of e)t[0]._logFn(t[1],t[2])}mockTypes(e){const t=e||this.options.mockFn;if(this._mockFn=t,typeof t=="function")for(const r in this.options.types)this[r]=t(r,this.options.types[r])||this[r],this[r].raw=this[r]}_wrapLogFn(e,t){return(...r)=>{if(De){at.push([this,e,r,t]);return}return this._logFn(e,r,t)}}_logFn(e,t,r){if((e.level||0)>this.level)return!1;const o={date:new Date,args:[],...e,level:Fe(e.level,this.options.types)};!r&&t.length===1&&_o(t[0])?Object.assign(o,t[0]):o.args=[...t],o.message&&(o.args.unshift(o.message),delete o.message),o.additional&&(Array.isArray(o.additional)||(o.additional=o.additional.split(`
`)),o.args.push(`
`+o.additional.join(`
`)),delete o.additional),o.type=typeof o.type=="string"?o.type.toLowerCase():"log",o.tag=typeof o.tag=="string"?o.tag:"";const n=(s=!1)=>{const u=(this._lastLog.count||0)-this.options.throttleMin;if(this._lastLog.object&&u>0){const d=[...this._lastLog.object.args];u>1&&d.push(`(repeated ${u} times)`),this._log({...this._lastLog.object,args:d}),this._lastLog.count=1}s&&(this._lastLog.object=o,this._log(o))};clearTimeout(this._lastLog.timeout);const i=this._lastLog.time&&o.date?o.date.getTime()-this._lastLog.time.getTime():0;if(this._lastLog.time=o.date,i<this.options.throttle)try{const s=JSON.stringify([o.type,o.tag,o.args]),u=this._lastLog.serialized===s;if(this._lastLog.serialized=s,u&&(this._lastLog.count=(this._lastLog.count||0)+1,this._lastLog.count>this.options.throttleMin)){this._lastLog.timeout=setTimeout(n,this.options.throttle);return}}catch{}n(!0)}_log(e){for(const t of this.options.reporters)t.log(e,{options:this.options})}}function Fe(a,e={},t=3){return a===void 0?t:typeof a=="number"?a:e[a]&&e[a].level!==void 0?e[a].level:t}M.prototype.add=M.prototype.addReporter;M.prototype.remove=M.prototype.removeReporter;M.prototype.clear=M.prototype.removeReporter;M.prototype.withScope=M.prototype.withTag;M.prototype.mock=M.prototype.mockTypes;M.prototype.pause=M.prototype.pauseLogs;M.prototype.resume=M.prototype.resumeLogs;function Mo(a={}){return new M(a)}class Io{constructor(e){this.options={...e},this.defaultColor="#7f8c8d",this.levelColorMap={0:"#c0392b",1:"#f39c12",3:"#00BCD4"},this.typeColorMap={success:"#2ecc71"}}_getLogFn(e){return e<1?console.__error||console.error:e===1?console.__warn||console.warn:console.__log||console.log}log(e){const t=this._getLogFn(e.level),r=e.type==="log"?"":e.type,o=e.tag||"",n=`
      background: ${this.typeColorMap[e.type]||this.levelColorMap[e.level]||this.defaultColor};
      border-radius: 0.5em;
      color: white;
      font-weight: bold;
      padding: 2px 0.5em;
    `,i=`%c${[o,r].filter(Boolean).join(":")}`;typeof e.args[0]=="string"?t(`${i}%c ${e.args[0]}`,n,"",...e.args.slice(1)):t(i,n,...e.args)}}function nt(a={}){return Mo({reporters:a.reporters||[new Io({})],prompt(e,t={}){return t.type==="confirm"?Promise.resolve(confirm(e)):Promise.resolve(prompt(e))},...a})}nt();const ko={pages:{type:Array,required:!0},pagesHiRes:{type:Array,default:()=>[]},flipDuration:{type:Number,default:1e3},zoomDuration:{type:Number,default:500},zooms:{type:Array,default:()=>[1,2,4]},perspective:{type:Number,default:2400},nPolygons:{type:Number,default:10},ambient:{type:Number,default:.4},gloss:{type:Number,default:.6},swipeMin:{type:Number,default:3},singlePage:{type:Boolean,default:!1},forwardDirection:{validator:a=>a==="right"||a==="left",default:"right"},centering:{type:Boolean,default:!0},startPage:{type:Number,default:null},loadingImage:{type:String,default:"spinner"},clickToZoom:{type:Boolean,default:!0},dragToFlip:{type:Boolean,default:!0},wheel:{type:String,default:"scroll"}},Lo={class:"vue3-flipbook"},zo=["src"],To=["src"],xo=["data-img"],Ae=Et({__name:"Flipbook",props:ko,emits:["flip-left-start","flip-left-end","flip-right-start","flip-right-end","zoom-start","zoom-end"],setup(a,{emit:e}){const t=nt({level:4});t.info("This will not be logged");const r=e,o=a,n=f(0),i=f(0),s=f(0),u=f(0),d=f(0),b=f(1),F=f(null),j=f(null),m=f(0),_=f(null),c=f(!1),L=f(!1),z=f(1/0),$=f(-1/0),k=f(),p=Xt({progress:0,direction:"right",frontImage:"",backImage:"",auto:!1,opacity:1}),I=f(0),Y=f(!1),W=f(0),re=f(0),J=(l=!1)=>{for(let v=u.value-3;v<=u.value+3;v++)fe(v,!1);if(l)for(let v=u.value;v<u.value+s.value;v++){const h=o.pagesHiRes[v];h&&typeof h=="string"&&(new Image().src=h)}},{zoom:y,zooming:K,canZoomIn:se,canZoomOut:Q,zoomIn:Z,zoomOut:O,zoomAt:ut,onWheel:it,scrollLeft:Ce,scrollTop:Oe}=fo(k,J),{imageWidth:G,imageHeight:ne,pageUrl:A,loadImage:vt,pageUrlLoading:fe,didLoadImage:ue}=mo(J,y,K),pt=g(()=>({zoom:K.value||y.value>1,"drag-to-scroll":!c.value})),ct=g(()=>({cursor:Be.value=="grabbing"?"grabbing":"auto"})),ie=g(()=>o.forwardDirection==="left"?Re.value:je.value),ve=g(()=>o.forwardDirection==="right"?Re.value:je.value),gt=g(()=>o.pages[0]===null?o.pages.length-1:o.pages.length),q=g(()=>o.pages[0]!==null?u.value+1:Math.max(1,u.value)),Re=g(()=>u.value<o.pages.length-s.value),je=g(()=>u.value>=s.value&&!(s.value===1&&!A(d.value-1))),me=g(()=>o.forwardDirection==="right"||s.value===1?d.value:b.value),de=g(()=>o.forwardDirection==="right"||s.value===1?b.value:d.value),ht=g(()=>A(me.value)),ft=g(()=>A(de.value)&&s.value===2),Be=g(()=>_.value?_.value:o.clickToZoom&&se.value?"zoom-in":o.clickToZoom&&Q.value?"zoom-out":o.dragToFlip?"grab":"auto"),H=g(()=>(n.value-S.value*s.value)/2),B=g(()=>(i.value-R.value)/2),mt=g(()=>{let l=S.value/o.nPolygons;return l=Math.ceil(l+1/y.value),l+"px"}),dt=g(()=>R.value+"px"),yt=g(()=>`${S.value}px ${R.value}px`),wt=g(()=>We("front").concat(We("back"))),E=g(()=>{if(s.value===1)return H.value;{let l;return A(me.value)?l=H.value:l=n.value/2,l<z.value?l:z.value}}),ee=g(()=>{if(s.value===1)return n.value-H.value;{let l=A(de.value)?n.value-H.value:n.value/2;return l>$.value?l:$.value}}),bt=g(()=>{let l=(ee.value-E.value)*y.value;return l<n.value?(E.value+(I.value??0))*y.value-(n.value-l)/2:(E.value+(I.value??0))*y.value}),_t=g(()=>{let l=(ee.value-E.value)*y.value;return l<n.value?(E.value+(I.value??0))*y.value-(n.value-l)/2:(ee.value+(I.value??0))*y.value-n.value}),Mt=g(()=>{let l=R.value*y.value;return l<i.value?B.value*y.value-(i.value-l)/2:B.value*y.value}),It=g(()=>{let l=R.value*y.value;return l<i.value?B.value*y.value-(i.value-l)/2:(B.value+R.value)*y.value-i.value});Yt(()=>{we(o.forwardDirection),ye(),window.addEventListener("resize",ye,{passive:!0}),y.value=o.zooms[0],t.info("props.startPage",o.startPage),Ue(o.startPage)}),Zt(()=>{window.removeEventListener("resize",ye)});const Ee=g(()=>{const l=n.value/s.value,v=G.value?l/G.value:1,h=ne.value?i.value/ne.value:1,w=v<h?v:h;return w<1?w:1}),S=g(()=>G.value?Math.round(G.value*Ee.value):1),R=g(()=>ne.value?Math.round(ne.value*Ee.value):1),ye=()=>{const l=k.value;l&&(n.value=l.clientWidth,i.value=l.clientHeight,s.value=n.value>i.value&&!o.singlePage?2:1,s.value===2&&(u.value&=-2),Xe(),z.value=1/0,$.value=-1/0)},Xe=()=>{s.value===1&&u.value===0&&o.pages.length&&!A(0)&&u.value++},Ye=()=>{ie.value&&be("left",!0)},Ze=()=>{ve.value&&be("right",!0)},We=l=>{let v=p.progress,h=p.direction;s.value===1&&h!==o.forwardDirection&&(v=1-v,h=o.forwardDirection),p.opacity=s.value===1&&v>.7?1-(v-.7)/.3:1;let w=l==="front"?p.frontImage:p.backImage;t.info("flip.backImage",p.backImage),t.info("flip.frontImage",p.frontImage),t.info("face",l),t.info("image",w);const N=S.value/o.nPolygons,{pageX:T,originRight:x}=io(l,h,H.value,s.value,o.forwardDirection,S.value,n.value),ce=no(v,h,l),Nt=vo(T,x,ce,n.value,o.perspective,B.value,S.value),{theta:ke,radius:Ct}=po(v,S.value);let Le=0,ze=ke/o.nPolygons,te=co(ke,ze,x),ge=ze/Math.PI*180;l==="back"&&(te=-te,ge=-ge),z.value=1/0,$.value=-1/0;const Je=[];let Te=1/0,xe=-1/0;for(let he=0;he<o.nPolygons;he++){const Ot=`${he/(o.nPolygons-1)*100}% 0px`,oe=Nt.clone(),Rt=x?ke-Le:Le,{x:jt,z:Ke}=ho(Rt,Ct,x,l,S.value);oe.translate3d(jt,0,Ke),oe.rotateY(-te);const Qe=oe.transformX(0),Ge=oe.transformX(N);Te=Math.min(Te,Qe,Ge),xe=Math.max(xe,Qe,Ge);const Bt=go(ce-te,ge,o.ambient,o.gloss)||"";Le+=ze,te+=ge,Je.push([`${l}${he}`,w,Bt,Ot,oe.toString(),Math.abs(Math.round(Ke))])}return $.value=xe,z.value=Te,Je},we=l=>{l!==o.forwardDirection?(p.frontImage=s.value===1?A(u.value-1):A(d.value),p.backImage=s.value===1?"":A(u.value-s.value+1)):(p.frontImage=s.value===1?A(u.value):A(b.value),p.backImage=s.value===1?"":A(u.value+s.value))},be=(l,v)=>{we(l),p.direction=l,p.progress=0,requestAnimationFrame(()=>{requestAnimationFrame(()=>{p.direction!==o.forwardDirection?s.value===2&&(d.value=u.value-s.value):s.value===1?d.value=u.value+s.value:b.value=u.value+1+s.value,v&&qe(!0)})})},qe=l=>{const v=Date.now(),h=o.flipDuration*(1-p.progress),w=p.progress;p.auto=!0,p.direction==="left"?r("flip-left-start",q.value):r("flip-right-start",q.value);const N=()=>{const T=Date.now()-v;let x=w+T/h;x=x>1?1:x,p.progress=l?st(x):x,x<1?requestAnimationFrame(N):(p.direction!==o.forwardDirection?u.value-=s.value:u.value+=s.value,p.direction==="left"?r("flip-left-end",q.value):r("flip-right-end",q.value),p.auto=!1)};N()},kt=()=>{const l=Date.now(),v=o.flipDuration*p.progress,h=p.progress;p.auto=!0;const w=()=>{requestAnimationFrame(()=>{const N=Date.now()-l;let T=h-h*N/v;T=T<0?0:T,p.progress=T,T>0?w():(d.value=u.value,b.value=u.value+1,p.auto=!1)})};w()},Lt=(l,v)=>{Ce.value=W.value-l,Oe.value=re.value-v},zt=g(()=>Math.min(_t.value,Math.max(bt.value,Ce.value))),Tt=g(()=>Math.min(It.value,Math.max(Mt.value,Oe.value)));V(zt,l=>{k.value&&(k.value.scrollLeft=l)}),V(Tt,l=>{k.value&&(k.value.scrollTop=l)});const _e=l=>{k.value&&(F.value=l.pageX,j.value=l.pageY,m.value=0,y.value<=1?o.dragToFlip&&(_.value="grab"):(W.value=k.value.scrollLeft,re.value=k.value.scrollTop,_.value="all-scroll"))},Me=l=>{if(!F.value||!j.value)return;const v=l.pageX-F.value,h=l.pageY-j.value;if(m.value=Math.max(m.value,Math.abs(v),Math.abs(h)),y.value>1){Lt(v,h);return}if(!o.dragToFlip||Math.abs(h)>Math.abs(v))return;_.value="grabbing";const w=v>0?"left":"right",N=v>0?ie.value:ve.value,T=v>0?o.swipeMin:-o.swipeMin;return N&&v>=T&&be(w,!1),p.direction===w&&(p.progress=Math.abs(v)/S.value,p.progress>1&&(p.progress=1)),!0},Ie=l=>{F.value&&(o.clickToZoom&&m.value<o.swipeMin&&ut(l),p.direction!==null&&!p.auto&&(p.progress>1/4?qe(!1):kt()),F.value=null,_.value=null)},xt=l=>{c.value=!0,_e(l.changedTouches[0])},Pt=l=>{Me(l.changedTouches[0])&&l.preventDefault()},He=l=>{Ie(l.changedTouches[0])},Dt=l=>{L.value=!0,!c.value&&l.button===0&&(_e(l),l.target&&l.target.setPointerCapture(l.pointerId))},Ft=l=>{c.value||Me(l)},Ve=l=>{c.value||(Ie(l),l.target&&l.target.releasePointerCapture(l.pointerId))},At=l=>{c.value||L.value||l.button===0&&_e(l)},$t=l=>{(!c.value||!L.value)&&Me(l)},St=l=>{(!c.value||!L.value)&&Ie(l)},Ue=l=>{l===null||l===q.value||(u.value=(o.pages??[])[0]===null&&s.value===2&&l===1?0:l-1,z.value=1/0,$.value=-1/0,I.value=pe.value)};V(u,()=>{d.value=u.value,b.value=u.value+1,J()});const pe=g(()=>o.centering?Math.round(n.value/2-(E.value+ee.value)/2):0);return V(pe,l=>{if(Y.value)return;I.value===0&&G.value!==null&&(I.value=l);const v=()=>{requestAnimationFrame(()=>{const h=pe.value-I.value;Math.abs(h)<.5?(I.value=pe.value,Y.value=!1):(I.value+=h*.1,v())})};Y.value=!0,v()}),V(()=>o.pages,(l,v)=>{we(o.forwardDirection),Xe(),!(v!=null&&v.length)&&l!=null&&l.length&&o.startPage>1&&l[0]==null&&u.value++}),V(()=>o.startPage,l=>{Ue(l)}),(l,v)=>(ae(),le("div",Lo,[Wt(l.$slots,"default",qt(Ht({canFlipLeft:ie.value,canFlipRight:ve.value,canZoomIn:P(se),canZoomOut:P(Q),page:q.value,numPages:gt.value,flipLeft:Ye,flipRight:Ze,zoomIn:P(Z),zoomOut:P(O)}))),X("div",{ref_key:"refViewport",ref:k,class:tt(["viewport",pt.value]),style:C(ct.value),onTouchmove:Pt,onPointermove:Ft,onMousemove:$t,onTouchend:He,onTouchcancel:He,onPointerup:Ve,onPointercancel:Ve,onMouseup:St,onWheel:v[2]||(v[2]=h=>P(it)(h,c.value))},[X("div",{class:"flipbook-container",style:C({transform:`scale(${P(y)})`})},[X("div",{class:"click-to-flip left",style:C({cursor:ie.value?"pointer":"auto"}),onClick:Ye},null,4),X("div",{class:"click-to-flip right",style:C({cursor:ve.value?"pointer":"auto"}),onClick:Ze},null,4),X("div",{style:C({transform:`translateX(${I.value}px)`})},[ht.value?(ae(),le("img",{key:0,class:"page fixed",style:C({width:S.value+"px",height:R.value+"px",left:H.value+"px",top:B.value+"px"}),src:P(fe)(me.value,!0),onLoad:v[0]||(v[0]=(...h)=>P(ue)&&P(ue)(...h))},null,44,zo)):et("",!0),ft.value?(ae(),le("img",{key:1,class:"page fixed",style:C({width:S.value+"px",height:R.value+"px",left:n.value/2+"px",top:B.value+"px"}),src:P(fe)(de.value,!0),onLoad:v[1]||(v[1]=(...h)=>P(ue)&&P(ue)(...h))},null,44,To)):et("",!0),X("div",{style:C({opacity:p.opacity})},[(ae(!0),le(Vt,null,Ut(wt.value,([h,w,N,T,x,ce])=>(ae(),le("div",{key:h,class:tt(["polygon",{blank:!w}]),"data-img":w,style:C({backgroundImage:w&&`url(${P(vt)(w)})`,backgroundSize:yt.value,backgroundPosition:T,width:mt.value,height:dt.value,transform:x,zIndex:ce})},[Jt(X("div",{class:"lighting",style:C({backgroundImage:N})},null,4),[[Kt,N.length]])],14,xo))),128))],4),X("div",{class:"bounding-box",style:C({left:E.value+"px",top:B.value+"px",width:ee.value-E.value+"px",height:R.value+"px",cursor:Be.value}),onTouchstart:xt,onPointerdown:Dt,onMousedown:At},null,36)],4)],4)],38)]))}});Ae.install=a=>(a.component(Ae.name,Ae),a);export{Ae as A};
