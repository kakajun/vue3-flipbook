var Et=Object.defineProperty;var Ht=(o,e,t)=>e in o?Et(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var B=(o,e,t)=>Ht(o,typeof e!="symbol"?e+"":e,t);import{d as Wt,b as m,r as qt,g as je,e as h,o as Ut,f as Vt,w as J,j as oe,k as ae,l as Jt,m as H,n as Kt,p as Qt,u as S,q as O,s as ot,F as Gt,t as eo,v as at,x as to,y as oo}from"./vue.esm-bundler-Dms8Sh9j.js";function Ae(o){if(o&&o.constructor===Array){var e=o.filter(function(r){return typeof r=="number"}).filter(function(r){return!isNaN(r)});if(o.length===6&&e.length===6){var t=le();return t[0]=e[0],t[1]=e[1],t[4]=e[2],t[5]=e[3],t[12]=e[4],t[13]=e[5],t}else if(o.length===16&&e.length===16)return o}throw new TypeError("Expected a `number[]` with length 6 or 16.")}function le(){for(var o=[],e=0;e<16;e++)e%5==0?o.push(1):o.push(0);return o}function ao(o,e){for(var t=Ae(o),r=Ae(e),s=[],l=0;l<4;l++)for(var u=[t[l],t[l+4],t[l+8],t[l+12]],i=0;i<4;i++){var n=i*4,p=[r[n],r[n+1],r[n+2],r[n+3]],b=u[0]*p[0]+u[1]*p[1]+u[2]*p[2]+u[3]*p[3];s[l+n]=b}return s}function lo(o){var e=le();return e[11]=-1/o,e}function ro(o){var e=Math.PI/180*o,t=le();return t[0]=t[10]=Math.cos(e),t[2]=t[8]=Math.sin(e),t[2]*=-1,t}function so(o){return"matrix3d("+Ae(o).join(", ")+")"}function lt(o,e,t){var r=le();return o!==void 0&&e!==void 0&&t!==void 0&&(r[12]=o,r[13]=e,r[14]=t),r}class Oe{constructor(e){B(this,"m");e?this.m=[...e]:this.m=le()}clone(){return new Oe(this.m)}multiply(e){this.m=ao(this.m,e)}perspective(e){this.multiply(lo(e))}transformX(e){return(e*this.m[0]+this.m[12])/(e*this.m[3]+this.m[15])}translate(e,t=0){this.multiply(lt(e,t,0))}translate3d(e,t,r){this.multiply(lt(e,t,r))}rotateY(e){this.multiply(ro(e))}toString(){return so(this.m)}}const uo=(o,e,t)=>{let r=0;return o>.5&&(r=-(o-.5)*2*180),e==="left"&&(r=-r),t==="back"&&(r+=180),r},ut=o=>Math.pow(o,2),no=o=>1-ut(1-o),nt=o=>o<.5?ut(o*2)/2:.5+no((o-.5)*2)/2,io=(o,e,t,r,s,l,u)=>{let i=t,n=!1;return r===1?s==="right"?o==="back"&&(n=!0,i=t-l):e==="left"?o==="back"?i=l-t:n=!0:o==="front"?i=l-t:n=!0:e==="left"?o==="back"?i=u/2:n=!0:o==="front"?i=u/2:n=!0,{pageX:i,originRight:n}},vo=(o,e,t,r,s,l,u)=>{const i=new Oe;return i.translate(r/2),i.perspective(s),i.translate(-r/2),i.translate(o,l),t&&(e&&i.translate(u),i.rotateY(t),e&&i.translate(-u)),i},po=(o,e)=>{let t;o<.5?t=o*2*Math.PI:t=(1-(o-.5)*2)*Math.PI,t==0&&(t=1e-9);const r=e/t;return{theta:t,radius:r}},co=(o,e,t)=>t?-o/Math.PI*180+e/2/Math.PI*180:e/2/Math.PI*180,go=(o,e,t,r)=>{const s=[],l=[-.5,-.25,0,.25,.5];if(t<1){const u=1-t,i=l.map(n=>(1-Math.cos((o-e*n)/180*Math.PI))*u);s.push(`linear-gradient(to right, rgba(0, 0, 0, ${i[0]}), rgba(0, 0, 0, ${i[1]}) 25%, rgba(0, 0, 0, ${i[2]}) 50%, rgba(0, 0, 0, ${i[3]}) 75%, rgba(0, 0, 0, ${i[4]}))`)}if(r>0){const u=l.map(i=>Math.max(Math.cos((o+30-e*i)/180*Math.PI)**200,Math.cos((o-30-e*i)/180*Math.PI)**200));s.push(`linear-gradient(to right, rgba(255, 255, 255, ${u[0]*r}), rgba(255, 255, 255, ${u[1]*r}) 25%, rgba(255, 255, 255, ${u[2]*r}) 50%, rgba(255, 255, 255, ${u[3]*r}) 75%, rgba(255, 255, 255, ${u[4]*r}))`)}return s.join(",")},ho=(o,e,t,r,s)=>{let l=Math.sin(o)*e;t&&(l=s-l);let u=(1-Math.cos(o))*e;return r==="back"&&(u=-u),{x:l,z:u}};function fo(o,e){const t=je();if(!t)throw new Error("useDrawer() can only be used inside setup() or functional components!");const r=t.props,s=m(1);let l=0;const u=m(!1),i=m(0),n=m(0),p=g=>{d.value&&(l+=1,r.zooms&&T(r.zooms[l],g))},b=g=>{k.value&&(l-=1,r.zooms&&T(r.zooms[l],g))},T=(g,w)=>{const z=o==null?void 0:o.value;if(z){let x,A;if(w){const Y=z.getBoundingClientRect();x=w.pageX-Y.left,A=w.pageY-Y.top}else x=z.clientWidth/2,A=z.clientHeight/2;const I=s.value,c=g,L=z.scrollLeft,W=z.scrollTop,re=x+L,se=A+W,q=re/I*c-x,y=se/I*c-A,ue=Date.now();u.value=!0,t==null||t.emit("zoom-start",g);const K=()=>{requestAnimationFrame(()=>{const Y=Date.now()-ue;let N=Y/r.zoomDuration;N=N>1?1:N,N=nt(N),s.value=I+(c-I)*N,i.value=L+(q-L)*N,n.value=W+(y-W)*N,Y<r.zoomDuration?K():(t==null||t.emit("zoom-end",g),u.value=!1,s.value=g,i.value=q,n.value=y)})};K(),c>1&&e(!0)}},R=g=>{l=(l+1)%r.zooms.length,T(r.zooms[l],g)},d=h(()=>!u.value&&l<r.zooms.length-1),k=h(()=>!u.value&&l>0);return{zoom:s,zooming:u,canZoomIn:d,canZoomOut:k,zoomIn:p,zoomOut:b,zoomAt:R,onWheel:(g,w)=>{r.wheel==="scroll"&&s.value>1&&!w&&o.value&&(i.value=o.value.scrollLeft+g.deltaX,n.value=o.value.scrollTop+g.deltaY,g.cancelable&&g.preventDefault()),r.wheel==="zoom"&&(g.deltaY>=100?(b(g),g.preventDefault()):g.deltaY<=-100&&(p(g),g.preventDefault()))},scrollLeft:i,scrollTop:n}}function mo(o,e,t){const r=m({}),s=m(0),l=m(0),u=m(),i=m(null),n=m(null),p=je();if(!p)throw new Error("useDrawer() can only be used inside setup() or functional components!");const b=p.props,T=(d,k=!1)=>{var g,w,z,x;return d<0?null:k&&e.value>1&&!t.value?d<(((g=b.pagesHiRes)==null?void 0:g.length)??0)?((w=b.pagesHiRes)==null?void 0:w[d])??null:null:d<(((z=b.pages)==null?void 0:z.length)??0)?((x=b.pages)==null?void 0:x[d])??null:null},R=d=>{if(i.value===null||r.value[d])return d;{const k=new Image;return k.onload=()=>{r.value[d]=!0},k.src=d,b.loadingImage||""}};return{imageWidth:i,imageHeight:n,pageUrl:T,loadImage:R,pageUrlLoading:(d,k=!1)=>{const g=T(d,k);if(g)return k&&e.value>1&&!t.value?g:R(g)},didLoadImage:d=>{i.value===null&&(i.value=d.target.naturalWidth,n.value=d.target.naturalHeight,o()),u.value&&(++s.value>=l.value&&u.value(),u.value=void 0)}}}const C={fatal:0,error:0,warn:1,log:2,info:3,success:3,fail:3,debug:4,trace:5,verbose:Number.POSITIVE_INFINITY},rt={silent:{level:-1},fatal:{level:C.fatal},error:{level:C.error},warn:{level:C.warn},log:{level:C.log},info:{level:C.info},success:{level:C.success},fail:{level:C.fail},ready:{level:C.info},start:{level:C.info},box:{level:C.info},debug:{level:C.debug},trace:{level:C.trace},verbose:{level:C.verbose}};function De(o){if(o===null||typeof o!="object")return!1;const e=Object.getPrototypeOf(o);return e!==null&&e!==Object.prototype&&Object.getPrototypeOf(e)!==null||Symbol.iterator in o?!1:Symbol.toStringTag in o?Object.prototype.toString.call(o)==="[object Module]":!0}function $e(o,e,t=".",r){if(!De(e))return $e(o,{},t);const s=Object.assign({},e);for(const l in o){if(l==="__proto__"||l==="constructor")continue;const u=o[l];u!=null&&(Array.isArray(u)&&Array.isArray(s[l])?s[l]=[...u,...s[l]]:De(u)&&De(s[l])?s[l]=$e(u,s[l],(t?`${t}.`:"")+l.toString()):s[l]=u)}return s}function yo(o){return(...e)=>e.reduce((t,r)=>$e(t,r,""),{})}const bo=yo();function wo(o){return Object.prototype.toString.call(o)==="[object Object]"}function _o(o){return!(!wo(o)||!o.message&&!o.args||o.stack)}let Fe=!1;const st=[];class M{constructor(e={}){B(this,"options");B(this,"_lastLog");B(this,"_mockFn");const t=e.types||rt;this.options=bo({...e,defaults:{...e.defaults},level:Se(e.level,t),reporters:[...e.reporters||[]]},{types:rt,throttle:1e3,throttleMin:5,formatOptions:{date:!0,colors:!1,compact:!0}});for(const r in t){const s={type:r,...this.options.defaults,...t[r]};this[r]=this._wrapLogFn(s),this[r].raw=this._wrapLogFn(s,!0)}this.options.mockFn&&this.mockTypes(),this._lastLog={}}get level(){return this.options.level}set level(e){this.options.level=Se(e,this.options.types,this.options.level)}prompt(e,t){if(!this.options.prompt)throw new Error("prompt is not supported!");return this.options.prompt(e,t)}create(e){const t=new M({...this.options,...e});return this._mockFn&&t.mockTypes(this._mockFn),t}withDefaults(e){return this.create({...this.options,defaults:{...this.options.defaults,...e}})}withTag(e){return this.withDefaults({tag:this.options.defaults.tag?this.options.defaults.tag+":"+e:e})}addReporter(e){return this.options.reporters.push(e),this}removeReporter(e){if(e){const t=this.options.reporters.indexOf(e);if(t!==-1)return this.options.reporters.splice(t,1)}else this.options.reporters.splice(0);return this}setReporters(e){return this.options.reporters=Array.isArray(e)?e:[e],this}wrapAll(){this.wrapConsole(),this.wrapStd()}restoreAll(){this.restoreConsole(),this.restoreStd()}wrapConsole(){for(const e in this.options.types)console["__"+e]||(console["__"+e]=console[e]),console[e]=this[e].raw}restoreConsole(){for(const e in this.options.types)console["__"+e]&&(console[e]=console["__"+e],delete console["__"+e])}wrapStd(){this._wrapStream(this.options.stdout,"log"),this._wrapStream(this.options.stderr,"log")}_wrapStream(e,t){e&&(e.__write||(e.__write=e.write),e.write=r=>{this[t].raw(String(r).trim())})}restoreStd(){this._restoreStream(this.options.stdout),this._restoreStream(this.options.stderr)}_restoreStream(e){e&&e.__write&&(e.write=e.__write,delete e.__write)}pauseLogs(){Fe=!0}resumeLogs(){Fe=!1;const e=st.splice(0);for(const t of e)t[0]._logFn(t[1],t[2])}mockTypes(e){const t=e||this.options.mockFn;if(this._mockFn=t,typeof t=="function")for(const r in this.options.types)this[r]=t(r,this.options.types[r])||this[r],this[r].raw=this[r]}_wrapLogFn(e,t){return(...r)=>{if(Fe){st.push([this,e,r,t]);return}return this._logFn(e,r,t)}}_logFn(e,t,r){if((e.level||0)>this.level)return!1;const s={date:new Date,args:[],...e,level:Se(e.level,this.options.types)};!r&&t.length===1&&_o(t[0])?Object.assign(s,t[0]):s.args=[...t],s.message&&(s.args.unshift(s.message),delete s.message),s.additional&&(Array.isArray(s.additional)||(s.additional=s.additional.split(`
`)),s.args.push(`
`+s.additional.join(`
`)),delete s.additional),s.type=typeof s.type=="string"?s.type.toLowerCase():"log",s.tag=typeof s.tag=="string"?s.tag:"";const l=(i=!1)=>{const n=(this._lastLog.count||0)-this.options.throttleMin;if(this._lastLog.object&&n>0){const p=[...this._lastLog.object.args];n>1&&p.push(`(repeated ${n} times)`),this._log({...this._lastLog.object,args:p}),this._lastLog.count=1}i&&(this._lastLog.object=s,this._log(s))};clearTimeout(this._lastLog.timeout);const u=this._lastLog.time&&s.date?s.date.getTime()-this._lastLog.time.getTime():0;if(this._lastLog.time=s.date,u<this.options.throttle)try{const i=JSON.stringify([s.type,s.tag,s.args]),n=this._lastLog.serialized===i;if(this._lastLog.serialized=i,n&&(this._lastLog.count=(this._lastLog.count||0)+1,this._lastLog.count>this.options.throttleMin)){this._lastLog.timeout=setTimeout(l,this.options.throttle);return}}catch{}l(!0)}_log(e){for(const t of this.options.reporters)t.log(e,{options:this.options})}}function Se(o,e={},t=3){return o===void 0?t:typeof o=="number"?o:e[o]&&e[o].level!==void 0?e[o].level:t}M.prototype.add=M.prototype.addReporter;M.prototype.remove=M.prototype.removeReporter;M.prototype.clear=M.prototype.removeReporter;M.prototype.withScope=M.prototype.withTag;M.prototype.mock=M.prototype.mockTypes;M.prototype.pause=M.prototype.pauseLogs;M.prototype.resume=M.prototype.resumeLogs;function Mo(o={}){return new M(o)}class ko{constructor(e){B(this,"options");B(this,"defaultColor");B(this,"levelColorMap");B(this,"typeColorMap");this.options={...e},this.defaultColor="#7f8c8d",this.levelColorMap={0:"#c0392b",1:"#f39c12",3:"#00BCD4"},this.typeColorMap={success:"#2ecc71"}}_getLogFn(e){return e<1?console.__error||console.error:e===1?console.__warn||console.warn:console.__log||console.log}log(e){const t=this._getLogFn(e.level),r=e.type==="log"?"":e.type,s=e.tag||"",l=`
      background: ${this.typeColorMap[e.type]||this.levelColorMap[e.level]||this.defaultColor};
      border-radius: 0.5em;
      color: white;
      font-weight: bold;
      padding: 2px 0.5em;
    `,u=`%c${[s,r].filter(Boolean).join(":")}`;typeof e.args[0]=="string"?t(`${u}%c ${e.args[0]}`,l,"",...e.args.slice(1)):t(u,l,...e.args)}}function it(o={}){return Mo({reporters:o.reporters||[new ko({})],prompt(e,t={}){return t.type==="confirm"?Promise.resolve(confirm(e)):Promise.resolve(prompt(e))},...o})}it();const Io={pages:{type:Array,required:!0},pagesHiRes:{type:Array,default:()=>[]},flipDuration:{type:Number,default:1e3},zoomDuration:{type:Number,default:500},zooms:{type:Array,default:()=>[1,2,4]},perspective:{type:Number,default:2400},nPolygons:{type:Number,default:10},ambient:{type:Number,default:.4},gloss:{type:Number,default:.6},swipeMin:{type:Number,default:3},singlePage:{type:Boolean,default:!1},forwardDirection:{validator:o=>o==="right"||o==="left",default:"right"},centering:{type:Boolean,default:!0},startPage:{type:Number,default:null},loadingImage:{type:String,default:"spinner"},clickToZoom:{type:Boolean,default:!0},dragToFlip:{type:Boolean,default:!0},wheel:{type:String,default:"scroll"}},Lo={class:"vue3-flipbook"},zo=["src"],xo=["src"],Po=["data-img"],Ce=Wt({name:"Flipbook",__name:"Flipbook",props:Io,emits:["flip-left-start","flip-left-end","flip-right-start","flip-right-end","zoom-start","zoom-end"],setup(o,{expose:e,emit:t}){const r=it({level:0}),s=t,l=o,u=m(0),i=m(0),n=m(0),p=m(0),b=m(0),T=m(1),R=m(null),d=m(null),k=m(0),g=m(null),w=m(!1),z=m(!1),x=m(1/0),A=m(-1/0),I=m(),c=qt({progress:0,direction:"right",frontImage:"",backImage:"",auto:!1,opacity:1}),L=m(0),W=m(!1),re=m(0),se=m(0),q=(a=!1)=>{for(let v=p.value-3;v<=p.value+3;v++)me(v,!1);if(a)for(let v=p.value;v<p.value+n.value;v++){const f=l.pagesHiRes[v];f&&typeof f=="string"&&(new Image().src=f)}},{zoom:y,zooming:ue,canZoomIn:K,canZoomOut:Y,zoomIn:N,zoomOut:vt,zoomAt:pt,onWheel:ct,scrollLeft:Re,scrollTop:Ne}=fo(I,q),{imageWidth:Q,imageHeight:ne,pageUrl:P,loadImage:gt,pageUrlLoading:me,didLoadImage:ie}=mo(q,y,ue);e({pageUrl:P}),je().proxy.pageUrl=P;const ht=h(()=>({zoom:ue.value||y.value>1,"drag-to-scroll":!w.value})),ft=h(()=>({cursor:Ye.value=="grabbing"?"grabbing":"auto"})),ve=h(()=>l.forwardDirection==="left"?Xe.value:Be.value),pe=h(()=>l.forwardDirection==="right"?Xe.value:Be.value),mt=h(()=>l.pages[0]===null?l.pages.length-1:l.pages.length),U=h(()=>l.pages[0]!==null?p.value+1:Math.max(1,p.value)),Xe=h(()=>p.value<l.pages.length-n.value),Be=h(()=>p.value>=n.value&&!(n.value===1&&!P(b.value-1))),de=h(()=>l.forwardDirection==="right"||n.value===1?b.value:T.value),ye=h(()=>l.forwardDirection==="right"||n.value===1?T.value:b.value),dt=h(()=>P(de.value)),yt=h(()=>P(ye.value)&&n.value===2),Ye=h(()=>g.value?g.value:l.clickToZoom&&K.value?"zoom-in":l.clickToZoom&&Y.value?"zoom-out":l.dragToFlip?"grab":"auto"),V=h(()=>(u.value-$.value*n.value)/2),Z=h(()=>(i.value-X.value)/2),bt=h(()=>{let a=$.value/l.nPolygons;return a=Math.ceil(a+1/y.value),a+"px"}),wt=h(()=>X.value+"px"),_t=h(()=>`${$.value}px ${X.value}px`),Mt=h(()=>qe("front").concat(qe("back"))),E=h(()=>{if(n.value===1)return V.value;{let a;return P(de.value)?a=V.value:a=u.value/2,a<x.value?a:x.value}}),G=h(()=>{if(n.value===1)return u.value-V.value;{let a=P(ye.value)?u.value-V.value:u.value/2;return a>A.value?a:A.value}}),kt=h(()=>{let a=(G.value-E.value)*y.value;return a<u.value?(E.value+(L.value??0))*y.value-(u.value-a)/2:(E.value+(L.value??0))*y.value}),It=h(()=>{let a=(G.value-E.value)*y.value;return a<u.value?(E.value+(L.value??0))*y.value-(u.value-a)/2:(G.value+(L.value??0))*y.value-u.value}),Lt=h(()=>{let a=X.value*y.value;return a<i.value?Z.value*y.value-(i.value-a)/2:Z.value*y.value}),zt=h(()=>{let a=X.value*y.value;return a<i.value?Z.value*y.value-(i.value-a)/2:(Z.value+X.value)*y.value-i.value});Ut(()=>{we(l.forwardDirection),be(),window.addEventListener("resize",be,{passive:!0}),y.value=l.zooms[0],r.info("props.startPage",l.startPage),Ke(l.startPage)}),Vt(()=>{window.removeEventListener("resize",be)});const Ze=h(()=>{const a=u.value/n.value,v=Q.value?a/Q.value:1,f=ne.value?i.value/ne.value:1,_=v<f?v:f;return _<1?_:1}),$=h(()=>Q.value?Math.round(Q.value*Ze.value):1),X=h(()=>ne.value?Math.round(ne.value*Ze.value):1),be=()=>{const a=I.value;a&&(u.value=a.clientWidth,i.value=a.clientHeight,n.value=u.value>i.value&&!l.singlePage?2:1,n.value===2&&(p.value&=-2),Ee(),x.value=1/0,A.value=-1/0)},Ee=()=>{n.value===1&&p.value===0&&l.pages.length&&!P(0)&&p.value++},He=()=>{ve.value&&_e("left",!0)},We=()=>{pe.value&&_e("right",!0)},qe=a=>{let v=c.progress,f=c.direction;n.value===1&&f!==l.forwardDirection&&(v=1-v,f=l.forwardDirection),c.opacity=n.value===1&&v>.7?1-(v-.7)/.3:1;let _=a==="front"?c.frontImage:c.backImage;r.info("flip.backImage",c.backImage),r.info("flip.frontImage",c.frontImage),r.info("face",a),r.info("image",_);const j=$.value/l.nPolygons,{pageX:D,originRight:F}=io(a,f,V.value,n.value,l.forwardDirection,$.value,u.value),ge=uo(v,f,a),Rt=vo(D,F,ge,u.value,l.perspective,Z.value,$.value),{theta:Le,radius:Nt}=po(v,$.value);let ze=0,xe=Le/l.nPolygons,ee=co(Le,xe,F),he=xe/Math.PI*180;a==="back"&&(ee=-ee,he=-he),x.value=1/0,A.value=-1/0;const Qe=[];let Pe=1/0,Te=-1/0;for(let fe=0;fe<l.nPolygons;fe++){const Xt=`${fe/(l.nPolygons-1)*100}% 0px`,te=Rt.clone(),Bt=F?Le-ze:ze,{x:Yt,z:Ge}=ho(Bt,Nt,F,a,$.value);te.translate3d(Yt,0,Ge),te.rotateY(-ee);const et=te.transformX(0),tt=te.transformX(j);Pe=Math.min(Pe,et,tt),Te=Math.max(Te,et,tt);const Zt=go(ge-ee,he,l.ambient,l.gloss)||"";ze+=xe,ee+=he,Qe.push([`${a}${fe}`,_,Zt,Xt,te.toString(),Math.abs(Math.round(Ge))])}return A.value=Te,x.value=Pe,Qe},we=a=>{a!==l.forwardDirection?(c.frontImage=n.value===1?P(p.value-1):P(b.value),c.backImage=n.value===1?"":P(p.value-n.value+1)):(c.frontImage=n.value===1?P(p.value):P(T.value),c.backImage=n.value===1?"":P(p.value+n.value))},_e=(a,v)=>{we(a),c.direction=a,c.progress=0,requestAnimationFrame(()=>{requestAnimationFrame(()=>{c.direction!==l.forwardDirection?n.value===2&&(b.value=p.value-n.value):n.value===1?b.value=p.value+n.value:T.value=p.value+1+n.value,v&&Ue(!0)})})},Ue=a=>{const v=Date.now(),f=l.flipDuration*(1-c.progress),_=c.progress;c.auto=!0,c.direction==="left"?s("flip-left-start",U.value):s("flip-right-start",U.value);const j=()=>{const D=Date.now()-v;let F=_+D/f;F=F>1?1:F,c.progress=a?nt(F):F,F<1?requestAnimationFrame(j):(c.direction!==l.forwardDirection?p.value-=n.value:p.value+=n.value,c.direction==="left"?s("flip-left-end",U.value):s("flip-right-end",U.value),c.auto=!1)};j()},xt=()=>{const a=Date.now(),v=l.flipDuration*c.progress,f=c.progress;c.auto=!0;const _=()=>{requestAnimationFrame(()=>{const j=Date.now()-a;let D=f-f*j/v;D=D<0?0:D,c.progress=D,D>0?_():(b.value=p.value,T.value=p.value+1,c.auto=!1)})};_()},Pt=(a,v)=>{Re.value=re.value-a,Ne.value=se.value-v},Tt=h(()=>Math.min(It.value,Math.max(kt.value,Re.value))),Dt=h(()=>Math.min(zt.value,Math.max(Lt.value,Ne.value)));J(Tt,a=>{I.value&&(I.value.scrollLeft=a)}),J(Dt,a=>{I.value&&(I.value.scrollTop=a)});const Me=a=>{I.value&&(R.value=a.pageX,d.value=a.pageY,k.value=0,y.value<=1?l.dragToFlip&&(g.value="grab"):(re.value=I.value.scrollLeft,se.value=I.value.scrollTop,g.value="all-scroll"))},ke=a=>{if(!R.value||!d.value)return;const v=a.pageX-R.value,f=a.pageY-d.value;if(k.value=Math.max(k.value,Math.abs(v),Math.abs(f)),y.value>1){Pt(v,f);return}if(!l.dragToFlip||Math.abs(f)>Math.abs(v))return;g.value="grabbing";const _=v>0?"left":"right",j=v>0?ve.value:pe.value,D=v>0?l.swipeMin:-l.swipeMin;return j&&v>=D&&_e(_,!1),c.direction===_&&(c.progress=Math.abs(v)/$.value,c.progress>1&&(c.progress=1)),!0},Ie=a=>{R.value&&(l.clickToZoom&&k.value<l.swipeMin&&pt(a),c.direction!==null&&!c.auto&&(c.progress>1/4?Ue(!1):xt()),R.value=null,g.value=null)},Ft=a=>{w.value=!0,Me(a.changedTouches[0])},St=a=>{ke(a.changedTouches[0])&&a.preventDefault()},Ve=a=>{Ie(a.changedTouches[0])},Ct=a=>{z.value=!0,!w.value&&a.button===0&&(Me(a),a.target&&a.target.setPointerCapture(a.pointerId))},At=a=>{w.value||ke(a)},Je=a=>{w.value||(Ie(a),a.target&&a.target.releasePointerCapture(a.pointerId))},$t=a=>{w.value||z.value||a.button===0&&Me(a)},jt=a=>{(!w.value||!z.value)&&ke(a)},Ot=a=>{(!w.value||!z.value)&&Ie(a)},Ke=a=>{a===null||a===U.value||(p.value=(l.pages??[])[0]===null&&n.value===2&&a===1?0:a-1,x.value=1/0,A.value=-1/0,L.value=ce.value)};J(p,()=>{b.value=p.value,T.value=p.value+1,q()});const ce=h(()=>l.centering?Math.round(u.value/2-(E.value+G.value)/2):0);return J(ce,a=>{if(W.value)return;L.value===0&&Q.value!==null&&(L.value=a);const v=()=>{requestAnimationFrame(()=>{const f=ce.value-L.value;Math.abs(f)<.5?(L.value=ce.value,W.value=!1):(L.value+=f*.1,v())})};W.value=!0,v()}),J(()=>l.pages,(a,v)=>{we(l.forwardDirection),Ee(),!(v!=null&&v.length)&&(a!=null&&a.length)&&l.startPage>1&&a[0]==null&&p.value++}),J(()=>l.startPage,a=>{Ke(a)}),(a,v)=>(ae(),oe("div",Lo,[Jt(a.$slots,"default",Kt(Qt({canFlipLeft:ve.value,canFlipRight:pe.value,canZoomIn:S(K),canZoomOut:S(Y),page:U.value,numPages:mt.value,flipLeft:He,flipRight:We,zoomIn:S(N),zoomOut:S(vt)}))),H("div",{ref_key:"refViewport",ref:I,class:at(["viewport",ht.value]),style:O(ft.value),onTouchmove:St,onPointermove:At,onMousemove:jt,onTouchend:Ve,onTouchcancel:Ve,onPointerup:Je,onPointercancel:Je,onMouseup:Ot,onWheel:v[2]||(v[2]=f=>S(ct)(f,w.value))},[H("div",{class:"flipbook-container",style:O({transform:`scale(${S(y)})`})},[H("div",{class:"click-to-flip left",style:O({cursor:ve.value?"pointer":"auto"}),onClick:He},null,4),H("div",{class:"click-to-flip right",style:O({cursor:pe.value?"pointer":"auto"}),onClick:We},null,4),H("div",{style:O({transform:`translateX(${L.value}px)`})},[dt.value?(ae(),oe("img",{key:0,class:"page fixed",style:O({width:$.value+"px",height:X.value+"px",left:V.value+"px",top:Z.value+"px"}),src:S(me)(de.value,!0),onLoad:v[0]||(v[0]=(...f)=>S(ie)&&S(ie)(...f))},null,44,zo)):ot("",!0),yt.value?(ae(),oe("img",{key:1,class:"page fixed",style:O({width:$.value+"px",height:X.value+"px",left:u.value/2+"px",top:Z.value+"px"}),src:S(me)(ye.value,!0),onLoad:v[1]||(v[1]=(...f)=>S(ie)&&S(ie)(...f))},null,44,xo)):ot("",!0),H("div",{style:O({opacity:c.opacity})},[(ae(!0),oe(Gt,null,eo(Mt.value,([f,_,j,D,F,ge])=>(ae(),oe("div",{key:f,class:at(["polygon",{blank:!_}]),"data-img":_,style:O({backgroundImage:_&&`url(${S(gt)(_)})`,backgroundSize:_t.value,backgroundPosition:D,width:bt.value,height:wt.value,transform:F,zIndex:ge})},[to(H("div",{class:"lighting",style:O({backgroundImage:j})},null,4),[[oo,j.length]])],14,Po))),128))],4),H("div",{class:"bounding-box",style:O({left:E.value+"px",top:Z.value+"px",width:G.value-E.value+"px",height:X.value+"px",cursor:Ye.value}),onTouchstart:Ft,onPointerdown:Ct,onMousedown:$t},null,36)],4)],4)],38)]))}});Ce.install=o=>{const e=Ce.name??"Flipbook";return o.component(e,Ce),o};export{Ce as C};
