import{d as Et,b as d,r as qt,e as f,o as Zt,f as Wt,w as U,g as le,j as re,k as Ut,n as Vt,l as Gt,u as D,m as B,p as N,q as Qe,F as Qt,s as Jt,t as Je,v as Kt,x as eo,y as to}from"./vue.esm-bundler-5S_td9RV.js";var oo=Object.defineProperty,ao=(a,e,l)=>e in a?oo(a,e,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[e]=l,lo=(a,e,l)=>(ao(a,typeof e!="symbol"?e+"":e,l),l);/*! @license Rematrix v0.7.2

	Copyright 2021 Julian Lloyd.

	Permission is hereby granted, free of charge, to any person obtaining a copy
	of this software and associated documentation files (the "Software"), to deal
	in the Software without restriction, including without limitation the rights
	to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
	copies of the Software, and to permit persons to whom the Software is
	furnished to do so, subject to the following conditions:

	The above copyright notice and this permission notice shall be included in
	all copies or substantial portions of the Software.

	THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
	IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
	FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
	AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
	LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
	OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
	THE SOFTWARE.
*/function Ae(a){if(a&&a.constructor===Array){var e=a.filter(function(s){return typeof s=="number"}).filter(function(s){return!isNaN(s)});if(a.length===6&&e.length===6){var l=V();return l[0]=e[0],l[1]=e[1],l[4]=e[2],l[5]=e[3],l[12]=e[4],l[13]=e[5],l}else if(a.length===16&&e.length===16)return a}throw new TypeError("Expected a `number[]` with length 6 or 16.")}function V(){for(var a=[],e=0;e<16;e++)e%5==0?a.push(1):a.push(0);return a}function ro(a,e){for(var l=Ae(a),s=Ae(e),o=[],u=0;u<4;u++)for(var g=[l[u],l[u+4],l[u+8],l[u+12]],v=0;v<4;v++){var n=v*4,b=[s[n],s[n+1],s[n+2],s[n+3]],x=g[0]*b[0]+g[1]*b[1]+g[2]*b[2]+g[3]*b[3];o[u+n]=x}return o}function so(a){var e=V();return e[11]=-1/a,e}function uo(a){var e=Math.PI/180*a,l=V();return l[0]=l[10]=Math.cos(e),l[2]=l[8]=Math.sin(e),l[2]*=-1,l}function no(a){return"matrix3d("+Ae(a).join(", ")+")"}function io(a,e){var l=V();return l[12]=a,e&&(l[13]=e),l}function vo(a,e,l){var s=V();return a!==void 0&&e!==void 0&&l!==void 0&&(s[12]=a,s[13]=e,s[14]=l),s}class $e{constructor(e){lo(this,"m"),e?this.m=[...e]:this.m=V()}clone(){return new $e(this.m)}multiply(e){this.m=ro(this.m,e)}perspective(e){this.multiply(so(e))}transformX(e){return(e*this.m[0]+this.m[12])/(e*this.m[3]+this.m[15])}translate(e,l){this.multiply(io(e,l))}translate3d(e,l,s){this.multiply(vo(e,l,s))}rotateY(e){this.multiply(uo(e))}toString(){return no(this.m)}}const po=(a,e,l)=>{let s=0;return a>.5&&(s=-(a-.5)*2*180),e==="left"&&(s=-s),l==="back"&&(s+=180),s},tt=a=>Math.pow(a,2),co=a=>1-tt(1-a),ot=a=>a<.5?tt(a*2)/2:.5+co((a-.5)*2)/2;function go(a,e,l){const s=to();if(!s)throw new Error("useDrawer() can only be used inside setup() or functional components!");const o=d(1);let u=0;const g=d(!1),v=d(0),n=d(0),b=h=>{L.value&&(u+=1,a.zooms&&A(a.zooms[u],h))},x=h=>{I.value&&(u-=1,a.zooms&&A(a.zooms[u],h))},A=(h,R)=>{const P=e==null?void 0:e.value;if(P){let C,k;if(R){const q=P.getBoundingClientRect();C=R.pageX-q.left,k=R.pageY-q.top}else C=P.clientWidth/2,k=P.clientHeight/2;const p=o.value,S=h,E=P.scrollLeft,Z=P.scrollTop,se=C+E,G=k+Z,w=se/p*S-C,Q=G/p*S-k,ue=Date.now();g.value=!0,s==null||s.emit("zoom-start",h);const J=()=>{requestAnimationFrame(()=>{const q=Date.now()-ue;let j=q/a.zoomDuration;j=j>1?1:j,j=ot(j),o.value=p+(S-p)*j,v.value=E+(w-E)*j,n.value=Z+(Q-Z)*j,q<a.zoomDuration?J():(s==null||s.emit("zoom-end",h),g.value=!1,o.value=h,v.value=w,n.value=Q)})};J(),S>1&&l(!0)}},_=h=>{u=(u+1)%a.zooms.length,A(a.zooms[u],h)},L=f(()=>!g.value&&u<a.zooms.length-1),I=f(()=>!g.value&&u>0);return{zoom:o,zooming:g,canZoomIn:L,canZoomOut:I,zoomIn:b,zoomOut:x,zoomAt:_,onWheel:(h,R)=>{a.wheel==="scroll"&&o.value>1&&!R&&e.value&&(v.value=e.value.scrollLeft+h.deltaX,n.value=e.value.scrollTop+h.deltaY,h.cancelable&&h.preventDefault()),a.wheel==="zoom"&&(h.deltaY>=100?(x(h),h.preventDefault()):h.deltaY<=-100&&(b(h),h.preventDefault()))},scrollLeft:v,scrollTop:n}}function ho(a,e,l,s){const o=d({}),u=d(0),g=d(0),v=d(),n=d(null),b=d(null),x=(_,L=!1)=>{var I,h;return L&&l.value>1&&!s.value?(_<a.pagesHiRes.length?(I=a.pagesHiRes)==null?void 0:I[_]:"")||"":(_<a.pages.length?(h=a.pages)==null?void 0:h[_]:"")||""},A=_=>{if(n.value===null||o.value[_])return _;{const L=new Image;return L.onload=()=>{o.value[_]=!0},L.src=_,a.loadingImage||""}};return{imageWidth:n,imageHeight:b,pageUrl:x,loadImage:A,pageUrlLoading:(_,L=!1)=>{const I=x(_,L);return L&&l.value>1&&!s.value?I:I&&A(I)},didLoadImage:_=>{n.value===null&&(n.value=_.target.naturalWidth,b.value=_.target.naturalHeight,e()),v.value&&(++u.value>=g.value&&v.value(),v.value=void 0)}}}const F={silent:Number.NEGATIVE_INFINITY,fatal:0,error:0,warn:1,log:2,info:3,success:3,fail:3,ready:3,start:3,box:3,debug:4,trace:5,verbose:Number.POSITIVE_INFINITY},Ke={silent:{level:-1},fatal:{level:F.fatal},error:{level:F.error},warn:{level:F.warn},log:{level:F.log},info:{level:F.info},success:{level:F.success},fail:{level:F.fail},ready:{level:F.info},start:{level:F.info},box:{level:F.info},debug:{level:F.debug},trace:{level:F.trace},verbose:{level:F.verbose}};function Te(a){return a!==null&&typeof a=="object"}function Se(a,e,l=".",s){if(!Te(e))return Se(a,{},l,s);const o=Object.assign({},e);for(const u in a){if(u==="__proto__"||u==="constructor")continue;const g=a[u];g!=null&&(s&&s(o,u,g,l)||(Array.isArray(g)&&Array.isArray(o[u])?o[u]=[...g,...o[u]]:Te(g)&&Te(o[u])?o[u]=Se(g,o[u],(l?`${l}.`:"")+u.toString(),s):o[u]=g))}return o}function fo(a){return(...e)=>e.reduce((l,s)=>Se(l,s,"",a),{})}const mo=fo();function yo(a){return Object.prototype.toString.call(a)==="[object Object]"}function bo(a){return!(!yo(a)||!a.message&&!a.args||a.stack)}let Pe=!1;const et=[];class M{constructor(e={}){const l=e.types||Ke;this.options=mo({...e,defaults:{...e.defaults},level:De(e.level,l),reporters:[...e.reporters||[]]},{types:Ke,throttle:1e3,throttleMin:5,formatOptions:{date:!0,colors:!1,compact:!0}});for(const s in l){const o={type:s,...this.options.defaults,...l[s]};this[s]=this._wrapLogFn(o),this[s].raw=this._wrapLogFn(o,!0)}this.options.mockFn&&this.mockTypes(),this._lastLog={}}get level(){return this.options.level}set level(e){this.options.level=De(e,this.options.types,this.options.level)}prompt(e,l){if(!this.options.prompt)throw new Error("prompt is not supported!");return this.options.prompt(e,l)}create(e){const l=new M({...this.options,...e});return this._mockFn&&l.mockTypes(this._mockFn),l}withDefaults(e){return this.create({...this.options,defaults:{...this.options.defaults,...e}})}withTag(e){return this.withDefaults({tag:this.options.defaults.tag?this.options.defaults.tag+":"+e:e})}addReporter(e){return this.options.reporters.push(e),this}removeReporter(e){if(e){const l=this.options.reporters.indexOf(e);if(l>=0)return this.options.reporters.splice(l,1)}else this.options.reporters.splice(0);return this}setReporters(e){return this.options.reporters=Array.isArray(e)?e:[e],this}wrapAll(){this.wrapConsole(),this.wrapStd()}restoreAll(){this.restoreConsole(),this.restoreStd()}wrapConsole(){for(const e in this.options.types)console["__"+e]||(console["__"+e]=console[e]),console[e]=this[e].raw}restoreConsole(){for(const e in this.options.types)console["__"+e]&&(console[e]=console["__"+e],delete console["__"+e])}wrapStd(){this._wrapStream(this.options.stdout,"log"),this._wrapStream(this.options.stderr,"log")}_wrapStream(e,l){e&&(e.__write||(e.__write=e.write),e.write=s=>{this[l].raw(String(s).trim())})}restoreStd(){this._restoreStream(this.options.stdout),this._restoreStream(this.options.stderr)}_restoreStream(e){e&&e.__write&&(e.write=e.__write,delete e.__write)}pauseLogs(){Pe=!0}resumeLogs(){Pe=!1;const e=et.splice(0);for(const l of e)l[0]._logFn(l[1],l[2])}mockTypes(e){const l=e||this.options.mockFn;if(this._mockFn=l,typeof l=="function")for(const s in this.options.types)this[s]=l(s,this.options.types[s])||this[s],this[s].raw=this[s]}_wrapLogFn(e,l){return(...s)=>{if(Pe){et.push([this,e,s,l]);return}return this._logFn(e,s,l)}}_logFn(e,l,s){if((e.level||0)>this.level)return!1;const o={date:new Date,args:[],...e,level:De(e.level,this.options.types)};!s&&l.length===1&&bo(l[0])?Object.assign(o,l[0]):o.args=[...l],o.message&&(o.args.unshift(o.message),delete o.message),o.additional&&(Array.isArray(o.additional)||(o.additional=o.additional.split(`
`)),o.args.push(`
`+o.additional.join(`
`)),delete o.additional),o.type=typeof o.type=="string"?o.type.toLowerCase():"log",o.tag=typeof o.tag=="string"?o.tag:"";const u=(v=!1)=>{const n=(this._lastLog.count||0)-this.options.throttleMin;if(this._lastLog.object&&n>0){const b=[...this._lastLog.object.args];n>1&&b.push(`(repeated ${n} times)`),this._log({...this._lastLog.object,args:b}),this._lastLog.count=1}v&&(this._lastLog.object=o,this._log(o))};clearTimeout(this._lastLog.timeout);const g=this._lastLog.time&&o.date?o.date.getTime()-this._lastLog.time.getTime():0;if(this._lastLog.time=o.date,g<this.options.throttle)try{const v=JSON.stringify([o.type,o.tag,o.args]),n=this._lastLog.serialized===v;if(this._lastLog.serialized=v,n&&(this._lastLog.count=(this._lastLog.count||0)+1,this._lastLog.count>this.options.throttleMin)){this._lastLog.timeout=setTimeout(u,this.options.throttle);return}}catch{}u(!0)}_log(e){for(const l of this.options.reporters)l.log(e,{options:this.options})}}function De(a,e={},l=3){return a===void 0?l:typeof a=="number"?a:e[a]&&e[a].level!==void 0?e[a].level:l}M.prototype.add=M.prototype.addReporter;M.prototype.remove=M.prototype.removeReporter;M.prototype.clear=M.prototype.removeReporter;M.prototype.withScope=M.prototype.withTag;M.prototype.mock=M.prototype.mockTypes;M.prototype.pause=M.prototype.pauseLogs;M.prototype.resume=M.prototype.resumeLogs;function wo(a={}){return new M(a)}class _o{constructor(e){this.options={...e},this.defaultColor="#7f8c8d",this.levelColorMap={0:"#c0392b",1:"#f39c12",3:"#00BCD4"},this.typeColorMap={success:"#2ecc71"}}_getLogFn(e){return e<1?console.__error||console.error:e===1?console.__warn||console.warn:console.__log||console.log}log(e){const l=this._getLogFn(e.level),s=e.type==="log"?"":e.type,o=e.tag||"",u=`
      background: ${this.typeColorMap[e.type]||this.levelColorMap[e.level]||this.defaultColor};
      border-radius: 0.5em;
      color: white;
      font-weight: bold;
      padding: 2px 0.5em;
    `,g=`%c${[o,s].filter(Boolean).join(":")}`;typeof e.args[0]=="string"?l(`${g}%c ${e.args[0]}`,u,"",...e.args.slice(1)):l(g,u,...e.args)}}function at(a={}){return wo({reporters:a.reporters||[new _o({})],prompt(e,l={}){return l.type==="confirm"?Promise.resolve(confirm(e)):Promise.resolve(prompt(e))},...a})}at();const Mo={pages:{type:Array,required:!0},pagesHiRes:{type:Array,default:()=>[]},flipDuration:{type:Number,default:1e3},zoomDuration:{type:Number,default:500},zooms:{type:Array,default:()=>[1,2,4]},perspective:{type:Number,default:2400},nPolygons:{type:Number,default:10},ambient:{type:Number,default:.4},gloss:{type:Number,default:.6},swipeMin:{type:Number,default:3},singlePage:{type:Boolean,default:!1},forwardDirection:{validator:a=>a==="right"||a==="left",default:"right"},centering:{type:Boolean,default:!0},startPage:{type:Number,default:null},loadingImage:{type:String,default:"spinner"},clickToZoom:{type:Boolean,default:!0},dragToFlip:{type:Boolean,default:!0},wheel:{type:String,default:"scroll"}},Io={class:"vue3-flipbook"},Lo=["src"],ko=["src"],Fe=Et({__name:"Flipbook",props:Mo,emits:["flip-left-start","flip-left-end","flip-right-start","flip-right-end","zoom-start","zoom-end"],setup(a,{emit:e}){const l=at({level:-1});l.info("This will not be logged");const s=e,o=a,u=d(0),g=d(0),v=d(1),n=d(0),b=d(0),x=d(1),A=d(null),_=d(null),L=d(0),I=d(null),h=d(!1),R=d(!1),P=d(1/0),C=d(-1/0),k=d(),p=qt({progress:0,direction:"right",frontImage:"",backImage:"",auto:!1,opacity:1}),S=d(0),E=d(!1),Z=d(0),se=d(0),G=(t=!1)=>{for(let r=n.value-3;r<=n.value+3;r++)me(r,!1);if(t)for(let r=n.value;r<n.value+v.value;r++){const i=o.pagesHiRes[r];i&&typeof i=="string"&&(new Image().src=i)}},{zoom:w,zooming:Q,canZoomIn:ue,canZoomOut:J,zoomIn:q,zoomOut:j,zoomAt:lt,onWheel:rt,scrollLeft:Ce,scrollTop:Ne}=go(o,k,G),{imageWidth:K,imageHeight:ne,pageUrl:$,loadImage:st,pageUrlLoading:me,didLoadImage:ie}=ho(o,G,w,Q),ut=f(()=>({zoom:Q.value||w.value>1,"drag-to-scroll":!h.value})),nt=f(()=>({cursor:Oe.value=="grabbing"?"grabbing":"auto"})),ve=f(()=>o.forwardDirection==="left"?Re.value:je.value),pe=f(()=>o.forwardDirection==="right"?Re.value:je.value),it=f(()=>o.pages[0]===null?o.pages.length-1:o.pages.length),W=f(()=>o.pages[0]!==null?n.value+1:Math.max(1,n.value)),Re=f(()=>n.value<o.pages.length-v.value),je=f(()=>n.value>=v.value&&!(v.value===1&&!$(b.value-1))),ye=f(()=>o.forwardDirection==="right"||v.value===1?b.value:x.value),be=f(()=>o.forwardDirection==="right"||v.value===1?x.value:b.value),vt=f(()=>$(ye.value)),pt=f(()=>$(be.value)&&v.value===2),Oe=f(()=>I.value?I.value:o.clickToZoom&&ue.value?"zoom-in":o.clickToZoom&&J.value?"zoom-out":o.dragToFlip?"grab":"auto"),O=f(()=>(u.value-T.value*v.value)/2),X=f(()=>(g.value-H.value)/2),ct=f(()=>{let t=T.value/o.nPolygons;return t=Math.ceil(t+1/w.value),t+"px"}),gt=f(()=>H.value+"px"),ht=f(()=>`${T.value}px ${H.value}px`),ft=f(()=>Ee("front").concat(Ee("back"))),Y=f(()=>{if(v.value===1)return O.value;{let t;return $(ye.value)?t=O.value:t=u.value/2,t<P.value?t:P.value}}),ee=f(()=>{if(v.value===1)return u.value-O.value;{let t=$(be.value)?u.value-O.value:u.value/2;return t>C.value?t:C.value}}),ce=f(()=>{let t=o.centering?Math.round(u.value/2-(Y.value+ee.value)/2):0;return S.value===0&&K.value!==null&&(S.value=t),t}),te=f(()=>Math.round(S.value)),dt=f(()=>{let t=(ee.value-Y.value)*w.value;return t<u.value?(Y.value+(te.value??0))*w.value-(u.value-t)/2:(Y.value+(te.value??0))*w.value}),mt=f(()=>{let t=(ee.value-Y.value)*w.value;return t<u.value?(Y.value+(te.value??0))*w.value-(u.value-t)/2:(ee.value+(te.value??0))*w.value-u.value}),yt=f(()=>{let t=H.value*w.value;return t<g.value?X.value*w.value-(g.value-t)/2:X.value*w.value}),bt=f(()=>{let t=H.value*w.value;return t<g.value?X.value*w.value-(g.value-t)/2:(X.value+H.value)*w.value-g.value});Zt(()=>{we(),window.addEventListener("resize",we,{passive:!0}),w.value=o.zooms[0],Ue(o.startPage)}),Wt(()=>{window.removeEventListener("resize",we)});const He=f(()=>{const t=u.value/v.value,r=K.value?t/K.value:1,i=ne.value?g.value/ne.value:1,c=r<i?r:i;return c<1?c:1}),T=f(()=>K.value?Math.round(K.value*He.value):1),H=f(()=>ne.value?Math.round(ne.value*He.value):1),we=()=>{const t=k.value;t&&(u.value=t.clientWidth,g.value=t.clientHeight,v.value=u.value>g.value&&!o.singlePage?2:1,v.value===2&&(n.value&=-2),Xe(),P.value=1/0,C.value=-1/0)},Xe=()=>{v.value===1&&n.value===0&&o.pages.length&&!$(0)&&n.value++},Ye=()=>{ve.value&&_e("left",!0)},Be=()=>{pe.value&&_e("right",!0)},wt=(t,r)=>{let i=O.value,c=!1;return v.value===1?o.forwardDirection==="right"?t==="back"&&(c=!0,i=O.value-T.value):r==="left"?t==="back"?i=T.value-O.value:c=!0:t==="front"?i=T.value-O.value:c=!0:r==="left"?t==="back"?i=u.value/2:c=!0:t==="front"?i=u.value/2:c=!0,{pageX:i,originRight:c}},_t=(t,r,i)=>{const c=new $e;return c.translate(u.value/2),c.perspective(o.perspective),c.translate(-u.value/2),c.translate(t,X.value),i&&(r&&c.translate(T.value),c.rotateY(i),r&&c.translate(-T.value)),c},Mt=t=>{let r;t<.5?r=t*2*Math.PI:r=(1-(t-.5)*2)*Math.PI,r==0&&(r=1e-9);const i=T.value/r;return{theta:r,radius:i}},It=(t,r,i,c)=>{let y=Math.sin(t)*r;i&&(y=T.value-y);let m=(1-Math.cos(t))*r;return c==="back"&&(m=-m),{x:y,z:m}},Ee=t=>{let r=p.progress,i=p.direction;v.value===1&&i!==o.forwardDirection&&(r=1-r,i=o.forwardDirection),p.opacity=v.value===1&&r>.7?1-(r-.7)/.3:1;let c=t==="front"?p.frontImage:p.backImage;const y=T.value/o.nPolygons,{pageX:m,originRight:z}=wt(t,i),ge=po(r,i,t),Nt=_t(m,z,ge),{theta:ke,radius:Rt}=Mt(r);let ze=0,he=ke/o.nPolygons,oe=z?-ke/Math.PI*180+he/2/Math.PI*180:he/2/Math.PI*180,fe=he/Math.PI*180;t==="back"&&(oe=-oe,fe=-fe),P.value=1/0,C.value=-1/0;const Ve=[],xe=[];for(let de=0;de<o.nPolygons;de++){const jt=`${de/(o.nPolygons-1)*100}% 0px`,ae=Nt.clone(),Ot=z?ke-ze:ze,{x:Ht,z:Ge}=It(Ot,Rt,z,t);ae.translate3d(Ht,0,Ge),ae.rotateY(-oe);const Xt=ae.transformX(0),Yt=ae.transformX(y);xe.push(Xt,Yt);const Bt=Lt(ge-oe,fe)||"";ze+=he,oe+=fe,Ve.push([`${t}${de}`,c,Bt,jt,ae.toString(),Math.abs(Math.round(Ge))])}return C.value=Math.max(...xe),P.value=Math.min(...xe),Ve},Lt=(t,r)=>{const i=[],c=[-.5,-.25,0,.25,.5];if(o.ambient<1){const y=1-o.ambient,m=c.map(z=>(1-Math.cos((t-r*z)/180*Math.PI))*y);i.push(`linear-gradient(to right, rgba(0, 0, 0, ${m[0]}), rgba(0, 0, 0, ${m[1]}) 25%, rgba(0, 0, 0, ${m[2]}) 50%, rgba(0, 0, 0, ${m[3]}) 75%, rgba(0, 0, 0, ${m[4]}))`)}if(o.gloss>0){const y=c.map(m=>Math.max(Math.cos((t+30-r*m)/180*Math.PI)**200,Math.cos((t-30-r*m)/180*Math.PI)**200));i.push(`linear-gradient(to right, rgba(255, 255, 255, ${y[0]*o.gloss}), rgba(255, 255, 255, ${y[1]*o.gloss}) 25%, rgba(255, 255, 255, ${y[2]*o.gloss}) 50%, rgba(255, 255, 255, ${y[3]*o.gloss}) 75%, rgba(255, 255, 255, ${y[4]*o.gloss}))`)}return i.join(",")},_e=(t,r)=>{if(t!==o.forwardDirection)if(v.value===1){const i=$(n.value-1);i?p.frontImage=i:l.error("flipStart error: url is null"),p.backImage=""}else p.frontImage=$(b.value),p.backImage=$(n.value-v.value+1);else v.value===1?(p.frontImage=$(n.value),p.backImage=""):(p.frontImage=$(x.value),p.backImage=$(n.value+v.value));p.direction=t,p.progress=0,requestAnimationFrame(()=>{requestAnimationFrame(()=>{p.direction!==o.forwardDirection?v.value===2&&(b.value=n.value-v.value):v.value===1?b.value=n.value+v.value:x.value=n.value+1+v.value,r&&qe(!0)})})},qe=t=>{const r=Date.now(),i=o.flipDuration*(1-p.progress),c=p.progress;p.auto=!0,p.direction==="left"?s("flip-left-start",W.value):s("flip-right-start",W.value);const y=()=>{const m=Date.now()-r;let z=c+m/i;z=z>1?1:z,p.progress=t?ot(z):z,z<1?requestAnimationFrame(y):(p.direction!==o.forwardDirection?n.value-=v.value:n.value+=v.value,p.direction==="left"?s("flip-left-end",W.value):s("flip-right-end",W.value),p.auto=!1)};y()},kt=()=>{const t=Date.now(),r=o.flipDuration*p.progress,i=p.progress;p.auto=!0;const c=()=>{requestAnimationFrame(()=>{const y=Date.now()-t;let m=i-i*y/r;m=m<0?0:m,p.progress=m,m>0?c():(b.value=n.value,x.value=n.value+1,p.auto=!1)})};c()},zt=(t,r)=>{Ce.value=Z.value-t,Ne.value=se.value-r},xt=f(()=>Math.min(mt.value,Math.max(dt.value,Ce.value))),Tt=f(()=>Math.min(bt.value,Math.max(yt.value,Ne.value)));U(xt,t=>{k.value&&(k.value.scrollLeft=t)}),U(Tt,t=>{k.value&&(k.value.scrollTop=t)});const Me=t=>{k.value&&(A.value=t.pageX,_.value=t.pageY,L.value=0,w.value<=1?o.dragToFlip&&(I.value="grab"):(Z.value=k.value.scrollLeft,se.value=k.value.scrollTop,I.value="all-scroll"))},Ie=t=>{if(!A.value||!_.value)return;const r=t.pageX-A.value,i=t.pageY-_.value;if(L.value=Math.max(L.value,Math.abs(r),Math.abs(i)),w.value>1){zt(r,i);return}if(!o.dragToFlip||Math.abs(i)>Math.abs(r))return;I.value="grabbing";const c=r>0?"left":"right",y=r>0?ve.value:pe.value,m=r>0?o.swipeMin:-o.swipeMin;return y&&r>=m&&_e(c,!1),p.direction===c&&(p.progress=Math.abs(r)/T.value,p.progress>1&&(p.progress=1)),!0},Le=t=>{A.value&&(o.clickToZoom&&L.value<o.swipeMin&&lt(t),p.direction!==null&&!p.auto&&(p.progress>1/4?qe(!1):kt()),A.value=null,I.value=null)},Pt=t=>{h.value=!0,Me(t.changedTouches[0])},Dt=t=>{Ie(t.changedTouches[0])&&t.preventDefault()},Ze=t=>{Le(t.changedTouches[0])},Ft=t=>{R.value=!0,!h.value&&t.button===0&&(Me(t),t.target&&t.target.setPointerCapture(t.pointerId))},At=t=>{h.value||Ie(t)},We=t=>{h.value||(Le(t),t.target&&t.target.releasePointerCapture(t.pointerId))},St=t=>{h.value||R.value||t.button===0&&Me(t)},$t=t=>{(!h.value||!R.value)&&Ie(t)},Ct=t=>{(!h.value||!R.value)&&Le(t)},Ue=t=>{t===null||t===W.value||(n.value=(o.pages??[])[0]===null&&v.value===2&&t===1?0:t-1,P.value=1/0,C.value=-1/0,S.value=ce.value)};return U(n,()=>{b.value=n.value,x.value=n.value+1,G()}),U(ce,()=>{if(E.value)return;const t=()=>{requestAnimationFrame(()=>{const r=ce.value-S.value;Math.abs(r)<.5?(S.value=ce.value,E.value=!1):(S.value+=r*.1,t())})};E.value=!0,t()}),U(()=>o.pages,(t,r)=>{Xe(),!(r!=null&&r.length)&&t!=null&&t.length&&o.startPage>1&&t[0]==null&&n.value++}),U(()=>o.startPage,t=>{Ue(t)}),(t,r)=>(le(),re("div",Io,[Ut(t.$slots,"default",Vt(Gt({canFlipLeft:ve.value,canFlipRight:pe.value,canZoomIn:D(ue),canZoomOut:D(J),page:W.value,numPages:it.value,flipLeft:Ye,flipRight:Be,zoomIn:D(q),zoomOut:D(j)}))),B("div",{ref_key:"refViewport",ref:k,class:Je(["viewport",ut.value]),style:N(nt.value),onTouchmove:Dt,onPointermove:At,onMousemove:$t,onTouchend:Ze,onTouchcancel:Ze,onPointerup:We,onPointercancel:We,onMouseup:Ct,onWheel:r[2]||(r[2]=i=>D(rt)(i,h.value))},[B("div",{class:"flipbook-container",style:N({transform:`scale(${D(w)})`})},[B("div",{class:"click-to-flip left",style:N({cursor:ve.value?"pointer":"auto"}),onClick:Ye},null,4),B("div",{class:"click-to-flip right",style:N({cursor:pe.value?"pointer":"auto"}),onClick:Be},null,4),B("div",{style:N({transform:`translateX(${te.value}px)`})},[vt.value?(le(),re("img",{key:0,class:"page fixed",style:N({width:T.value+"px",height:H.value+"px",left:O.value+"px",top:X.value+"px"}),src:D(me)(ye.value,!0),onLoad:r[0]||(r[0]=(...i)=>D(ie)&&D(ie)(...i))},null,44,Lo)):Qe("",!0),pt.value?(le(),re("img",{key:1,class:"page fixed",style:N({width:T.value+"px",height:H.value+"px",left:u.value/2+"px",top:X.value+"px"}),src:D(me)(be.value,!0),onLoad:r[1]||(r[1]=(...i)=>D(ie)&&D(ie)(...i))},null,44,ko)):Qe("",!0),B("div",{style:N({opacity:p.opacity})},[(le(!0),re(Qt,null,Jt(ft.value,([i,c,y,m,z,ge])=>(le(),re("div",{key:i,class:Je(["polygon",{blank:!c}]),style:N({backgroundImage:c&&`url(${D(st)(c)})`,backgroundSize:ht.value,backgroundPosition:m,width:ct.value,height:gt.value,transform:z,zIndex:ge})},[Kt(B("div",{class:"lighting",style:N({backgroundImage:y})},null,4),[[eo,y.length]])],6))),128))],4),B("div",{class:"bounding-box",style:N({left:Y.value+"px",top:X.value+"px",width:ee.value-Y.value+"px",height:H.value+"px",cursor:Oe.value}),onTouchstart:Pt,onPointerdown:Ft,onMousedown:St},null,36)],4)],4)],38)]))}});Fe.install=a=>(a.component(Fe.name,Fe),a);export{Fe as F};
