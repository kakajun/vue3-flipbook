import{b as h,r as Ba,d as c,o as Ra,e as Za,w as j,f as G,g as qa,n as Ha,j as Ya,u as N,k as S,l as X,m as je,F as Sa,p as Wa,q as Ee,s as ee,t as Oa,v as Ca}from"./vue.esm-bundler-3G0u27Tu.js";/*! @license Rematrix v0.7.2

	Copyright 2021 Julian Lloyd.

	Permission is hereby granted, free of charge, to any person obtaining a copy
	of this software and associated documentation files (the "Software"), to deal
	in the Software without restriction, including without limitation the rights
	to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
	copies of the Software, and to permit persons to whom the Software is
	furnished to do so, subject to the following conditions:

	The above copyright notice and this permission notice shall be included in
	all copies or substantial portions of the Software.

	THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
	IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
	FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
	AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
	LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
	OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
	THE SOFTWARE.
*/function ke(t){if(t&&t.constructor===Array){var u=t.filter(function(a){return typeof a=="number"}).filter(function(a){return!isNaN(a)});if(t.length===6&&u.length===6){var v=E();return v[0]=u[0],v[1]=u[1],v[4]=u[2],v[5]=u[3],v[12]=u[4],v[13]=u[5],v}else if(t.length===16&&u.length===16)return t}throw new TypeError("Expected a `number[]` with length 6 or 16.")}function E(){for(var t=[],u=0;u<16;u++)u%5==0?t.push(1):t.push(0);return t}function ja(t,u){for(var v=ke(t),a=ke(u),g=[],p=0;p<4;p++)for(var r=[v[p],v[p+4],v[p+8],v[p+12]],i=0;i<4;i++){var f=i*4,I=[a[f],a[f+1],a[f+2],a[f+3]],P=r[0]*I[0]+r[1]*I[1]+r[2]*I[2]+r[3]*I[3];g[p+f]=P}return g}function Ea(t){var u=E();return u[11]=-1/t,u}function Ua(t){var u=Math.PI/180*t,v=E();return v[0]=v[10]=Math.cos(u),v[2]=v[8]=Math.sin(u),v[2]*=-1,v}function Va(t){return"matrix3d("+ke(t).join(", ")+")"}function _a(t,u){var v=E();return v[12]=t,u&&(v[13]=u),v}function Ja(t,u,v){var a=E();return t!==void 0&&u!==void 0&&v!==void 0&&(a[12]=t,a[13]=u,a[14]=v),a}class xe{constructor(u){u?u.m?this.m=[...u.m]:this.m=[...u]:this.m=E()}clone(){return new xe(this)}multiply(u){this.m=ja(this.m,u)}perspective(u){this.multiply(Ea(u))}transformX(u){return(u*this.m[0]+this.m[12])/(u*this.m[3]+this.m[15])}translate(u,v){this.multiply(_a(u,v))}translate3d(u,v,a){this.multiply(Ja(u,v,a))}rotateY(u){this.multiply(Ua(u))}toString(){return Va(this.m)}}const Ka=(t,u,v)=>{let a=0;return t>.5&&(a=-(t-.5)*2*180),u==="left"&&(a=-a),v==="back"&&(a+=180),a},Ue=t=>Math.pow(t,2),Qa=t=>1-Ue(1-t),Ve=t=>t<.5?Ue(t*2)/2:.5+Qa((t-.5)*2)/2;function _e(t,u,v,a){const g=h(1),p=h(0),r=h(!1),i=h(0),f=h(0),I=(m=null)=>{M.value&&(p.value+=1,B(t.zooms[p.value],m))},P=(m=null)=>{z.value&&(p.value-=1,B(t.zooms[p.value],m))},B=(m,D=null)=>{const T=v.value;let $,o;if(D){const W=T.getBoundingClientRect();$=D.pageX-W.left,o=D.pageY-W.top}else $=T.clientWidth/2,o=T.clientHeight/2;const L=g.value,q=m,O=T.scrollLeft,C=T.scrollTop,U=$+O,y=o+C,ae=U/L*q-$,V=y/L*q-o,le=Date.now();r.value=!0,u("zoom-start",m);const te=()=>{requestAnimationFrame(()=>{const W=Date.now()-le;let A=W/t.zoomDuration;A=A>1||A,A=Ve(A),g.value=L+(q-L)*A,i.value=O+(ae-O)*A,f.value=C+(V-C)*A,W<t.zoomDuration?te():(u("zoom-end",m),r.value=!1,g.value=m,i.value=ae,f.value=V)})};te(),q>1&&a(!0)},b=m=>{p.value=(p.value+1)%t.zooms.length,B(t.zooms[p.value],m)},M=c(()=>!r.value&&p.value<t.zooms.length-1),z=c(()=>!r.value&&p.value>0);return{zoom:g,zooming:r,canZoomIn:M,canZoomOut:z,zoomIn:I,zoomOut:P,zoomAt:b,onWheel:(m,D)=>{t.wheel==="scroll"&&g.value>1&&!D.value&&(i.value=v.value.scrollLeft+m.deltaX,f.value=v.value.scrollTop+m.deltaY,m.cancelable&&m.preventDefault()),t.wheel==="zoom"&&(m.deltaY>=100?(P(m),m.preventDefault()):m.deltaY<=-100&&(I(m),m.preventDefault()))},scrollLeft:i,scrollTop:f}}function Ga(t,u){const{zoom:v,zooming:a}=_e(t),g=h({}),p=h(0),r=h(0),i=h(null),f=h(null),I=h(null),P=(b,M=!1)=>M&&v.value>1&&!a.value?t.pagesHiRes[b]||null:t.pages[b]||null,B=b=>{if(f.value===null||g.value[b])return b;{const M=new Image;return M.onload=()=>{g.value[b]=!0},M.src=b,t.loadingImage}};return{imageWidth:f,imageHeight:I,pageUrl:P,loadImage:B,pageUrlLoading:(b,M=!1)=>{const z=P(b,M);return M&&v.value>1&&!a.value?z:z&&B(z)},onImageLoad:(b,M)=>{p.value=0,r.value=b,i.value=M},didLoadImage:b=>{f.value===null&&(f.value=(b.target||b.path[0]).naturalWidth,I.value=(b.target||b.path[0]).naturalHeight,u()),i.value&&++p.value>=r.value&&(i.value(),i.value=null)}}}const el={class:"vue3-flipbook"},al=["src"],ll=["src"],ul={__name:"Flipbook",props:{pages:{type:Array,required:!0},pagesHiRes:{type:Array,default:function(){return[]}},flipDuration:{type:Number,default:1e3},zoomDuration:{type:Number,default:500},zooms:{type:Array,default:function(){return[1,2,4]}},perspective:{type:Number,default:2400},nPolygons:{type:Number,default:10},ambient:{type:Number,default:.4},gloss:{type:Number,default:.6},swipeMin:{type:Number,default:3},singlePage:{type:Boolean,default:!1},forwardDirection:{validator:function(t){return t==="right"||t==="left"},default:"right"},centering:{type:Boolean,default:!0},startPage:{type:Number,default:null},loadingImage:{type:String,default:"spinner"},clickToZoom:{type:Boolean,default:!0},dragToFlip:{type:Boolean,default:!0},wheel:{type:String,default:"scroll"}},emits:["flip-left-start","flip-left-end","flip-right-start","flip-right-end","zoom-start","zoom-end"],setup(t,{emit:u}){const v=u,a=t,g=h(0),p=h(0),r=h(1),i=h(0),f=h(0),I=h(1),P=h(null),B=h(null),b=h(0),M=h(null),z=h(!1),m=h(!1),D=h(1/0),T=h(-1/0),$=h(null),o=Ba({progress:0,direction:null,frontImage:null,backImage:null,auto:!1,opacity:1}),L=h(null),q=h(!1),O=h(0),C=h(0),U=(e=!1)=>{for(let l=i.value-3;l<=i.value+3;l++)pe(l);if(e)for(let l=i.value;l<i.value+r.value;l++){const n=a.pagesHiRes[l];n&&(new Image().src=n)}},{zoom:y,zooming:ae,canZoomIn:V,canZoomOut:le,zoomIn:te,zoomOut:W,zoomAt:A,onWheel:Je,scrollLeft:Pe,scrollTop:De}=_e(a,v,$,U),{imageWidth:ge,imageHeight:Te,pageUrl:F,loadImage:Ke,pageUrlLoading:pe,onImageLoad:$e,didLoadImage:Le}=Ga(a,U),Qe=c(()=>({zoom:ae.value||y.value>1,"drag-to-scroll":!z.value})),Ge=c(()=>({cursor:Xe.value=="grabbing"?"grabbing":"auto"})),ue=c(()=>a.forwardDirection==="left"?Fe.value:Ne.value),oe=c(()=>a.forwardDirection==="right"?Fe.value:Ne.value),ea=c(()=>a.pages[0]===null?a.pages.length-1:a.pages.length),re=c(()=>a.pages[0]!==null?i.value+1:Math.max(1,i.value)),Fe=c(()=>!o.direction&&i.value<a.pages.length-r.value),Ne=c(()=>!o.direction&&i.value>=r.value&&!(r.value===1&&!F(f.value-1))),he=c(()=>a.forwardDirection==="right"||r.value===1?f.value:I.value),me=c(()=>a.forwardDirection==="right"||r.value===1?I.value:f.value),aa=c(()=>F(he.value)),la=c(()=>F(me.value)&&r.value===2),Xe=c(()=>M.value?M.value:a.clickToZoom&&V.value?"zoom-in":a.clickToZoom&&le.value?"zoom-out":a.dragToFlip?"grab":"auto"),R=c(()=>(g.value-x.value*r.value)/2),H=c(()=>(p.value-Z.value)/2),ta=c(()=>{let e=x.value/a.nPolygons;return e=Math.ceil(e+1/y.value),e+"px"}),ua=c(()=>Z.value+"px"),oa=c(()=>`${x.value}px ${Z.value}px`),ra=c(()=>qe("front").concat(qe("back"))),Y=c(()=>{if(r.value===1)return R.value;{let e;return F(he.value)?e=R.value:e=g.value/2,e<D.value?e:D.value}}),_=c(()=>{if(r.value===1)return g.value-R.value;{let e=F(me.value)?g.value-R.value:g.value/2;return e>T.value?e:T.value}}),ne=c(()=>{let e=a.centering?Math.round(g.value/2-(Y.value+_.value)/2):0;return L.value===null&&ge.value!==null&&(L.value=e),e}),J=c(()=>Math.round(L.value)),na=c(()=>{let e=(_.value-Y.value)*y.value;return e<g.value?(Y.value+J.value)*y.value-(g.value-e)/2:(Y.value+J.value)*y.value}),va=c(()=>{let e=(_.value-Y.value)*y.value;return e<g.value?(Y.value+J.value)*y.value-(g.value-e)/2:(_.value+J.value)*y.value-g.value}),ia=c(()=>{let e=Z.value*y.value;return e<p.value?H.value*y.value-(p.value-e)/2:H.value*y.value}),sa=c(()=>{let e=Z.value*y.value;return e<p.value?H.value*y.value-(p.value-e)/2:(H.value+Z.value)*y.value-p.value});Ra(()=>{window.addEventListener("resize",de,{passive:!0}),de(),y.value=a.zooms[0],We(a.startPage)}),Za(()=>{window.removeEventListener("resize",de,{passive:!0})});const Ae=c(()=>{const e=g.value/r.value/ge.value,l=p.value/Te.value,n=e<l?e:l;return n<1?n:1}),x=c(()=>Math.round(ge.value*Ae.value)),Z=c(()=>Math.round(Te.value*Ae.value)),de=()=>{const e=$.value;e&&(g.value=e.clientWidth,p.value=e.clientHeight,r.value=g.value>p.value&&!a.singlePage?2:1,r.value===2&&(i.value&=-2),Be(),D.value=1/0,T.value=-1/0)},Be=()=>{r.value===1&&i.value===0&&a.pages.length&&!F(0)&&i.value++},Re=()=>{ue.value&&fe("left",!0)},Ze=()=>{oe.value&&fe("right",!0)},ca=(e,l)=>{let n=R.value,s=!1;return r.value===1?a.forwardDirection==="right"?e==="back"&&(s=!0,n=R.value-x.value):l==="left"?e==="back"?n=x.value-R.value:s=!0:e==="front"?n=x.value-R.value:s=!0:l==="left"?e==="back"?n=g.value/2:s=!0:e==="front"?n=g.value/2:s=!0,{pageX:n,originRight:s}},ga=(e,l,n)=>{const s=new xe;return s.translate(g.value/2),s.perspective(a.perspective),s.translate(-g.value/2),s.translate(e,H.value),n&&(l&&s.translate(x.value),s.rotateY(n),l&&s.translate(-x.value)),s},pa=e=>{let l;e<.5?l=e*2*Math.PI:l=(1-(e-.5)*2)*Math.PI,l==0&&(l=1e-9);const n=x.value/l;return{theta:l,radius:n}},ha=(e,l,n,s)=>{let w=Math.sin(e)*l;n&&(w=x.value-w);let d=(1-Math.cos(e))*l;return s==="back"&&(d=-d),{x:w,z:d}},qe=e=>{if(!o.direction)return[];let l=o.progress,n=o.direction;r.value===1&&n!==a.forwardDirection&&(l=1-l,n=a.forwardDirection),o.opacity=r.value===1&&l>.7?1-(l-.7)/.3:1;let s=e==="front"?o.frontImage:o.backImage;const w=x.value/a.nPolygons,{pageX:d,originRight:k}=ca(e,n),ve=Ka(l,n,e),Da=ga(d,k,ve),{theta:Me,radius:Ta}=pa(l);let Ie=0,ie=Me/a.nPolygons,K=k?-Me/Math.PI*180+ie/2/Math.PI*180:ie/2/Math.PI*180,se=ie/Math.PI*180;e==="back"&&(K=-K,se=-se),D.value=1/0,T.value=-1/0;const Oe=[],ze=[];for(let ce=0;ce<a.nPolygons;ce++){const $a=`${ce/(a.nPolygons-1)*100}% 0px`,Q=Da.clone(),La=k?Me-Ie:Ie,{x:Fa,z:Ce}=ha(La,Ta,k,e);Q.translate3d(Fa,0,Ce),Q.rotateY(-K);const Na=Q.transformX(0),Xa=Q.transformX(w);ze.push(Na,Xa);const Aa=ma(ve-K,se);Ie+=ie,K+=se,Oe.push([`${e}${ce}`,s,Aa,$a,Q.toString(),Math.abs(Math.round(Ce))])}return T.value=Math.max(...ze),D.value=Math.min(...ze),Oe},ma=(e,l)=>{const n=[],s=[-.5,-.25,0,.25,.5];if(a.ambient<1){const w=1-a.ambient,d=s.map(k=>(1-Math.cos((e-l*k)/180*Math.PI))*w);n.push(`linear-gradient(to right, rgba(0, 0, 0, ${d[0]}), rgba(0, 0, 0, ${d[1]}) 25%, rgba(0, 0, 0, ${d[2]}) 50%, rgba(0, 0, 0, ${d[3]}) 75%, rgba(0, 0, 0, ${d[4]}))`)}if(a.gloss>0){const w=s.map(d=>Math.max(Math.cos((e+30-l*d)/180*Math.PI)**200,Math.cos((e-30-l*d)/180*Math.PI)**200));n.push(`linear-gradient(to right, rgba(255, 255, 255, ${w[0]*a.gloss}), rgba(255, 255, 255, ${w[1]*a.gloss}) 25%, rgba(255, 255, 255, ${w[2]*a.gloss}) 50%, rgba(255, 255, 255, ${w[3]*a.gloss}) 75%, rgba(255, 255, 255, ${w[4]*a.gloss}))`)}return n.join(",")},fe=(e,l)=>{e!==a.forwardDirection?r.value===1?(o.frontImage=F(i.value-1),o.backImage=null):(o.frontImage=F(f.value),o.backImage=F(i.value-r.value+1)):r.value===1?(o.frontImage=F(i.value),o.backImage=null):(o.frontImage=F(I.value),o.backImage=F(i.value+r.value)),o.direction=e,o.progress=0,requestAnimationFrame(()=>{requestAnimationFrame(()=>{o.direction!==a.forwardDirection?r.value===2&&(f.value=i.value-r.value):r.value===1?f.value=i.value+r.value:I.value=i.value+1+r.value,l&&He(!0)})})},He=e=>{const l=Date.now(),n=a.flipDuration*(1-o.progress),s=o.progress;o.auto=!0,v(`flip-${o.direction}-start`,re.value);const w=()=>{const d=Date.now()-l;let k=s+d/n;k=k>1?1:k,o.progress=e?Ve(k):k,k<1?requestAnimationFrame(w):(o.direction!==a.forwardDirection?i.value-=r.value:i.value+=r.value,v(`flip-${o.direction}-end`,re.value),r.value===1&&o.direction===a.forwardDirection?o.direction=null:$e(1,()=>{o.direction=null}),o.auto=!1)};w()},da=()=>{const e=Date.now(),l=a.flipDuration*o.progress,n=o.progress;o.auto=!0;const s=()=>{requestAnimationFrame(()=>{const w=Date.now()-e;let d=n-n*w/l;d=d<0?0:d,o.progress=d,d>0?s():(f.value=i.value,I.value=i.value+1,r.value===1&&o.direction!==a.forwardDirection?o.direction=null:$e(1,()=>{o.direction=null}),o.auto=!1)})};s()},fa=(e,l)=>{Pe.value=O.value-e,De.value=C.value-l},ba=c(()=>Math.min(va.value,Math.max(na.value,Pe.value))),wa=c(()=>Math.min(sa.value,Math.max(ia.value,De.value)));j(ba,e=>{$.value.scrollLeft=e}),j(wa,e=>{$.value.scrollTop=e});const be=e=>{P.value=e.pageX,B.value=e.pageY,b.value=0,y.value<=1?a.dragToFlip&&(M.value="grab"):(O.value=$.value.scrollLeft,C.value=$.value.scrollTop,M.value="all-scroll")},we=e=>{if(!P.value)return;const l=e.pageX-P.value,n=e.pageY-B.value;if(b.value=Math.max(b.value,Math.abs(l),Math.abs(n)),y.value>1){fa(l,n);return}if(!a.dragToFlip||Math.abs(n)>Math.abs(l))return;M.value="grabbing";const s=l>0?"left":"right",w=l>0?ue.value:oe.value,d=l>0?a.swipeMin:-a.swipeMin;return o.direction===null&&w&&l>=d&&fe(s,!1),o.direction===s&&(o.progress=Math.abs(l)/x.value,o.progress>1&&(o.progress=1)),!0},ye=e=>{P.value&&(a.clickToZoom&&b.value<a.swipeMin&&A(e),o.direction!==null&&!o.auto&&(o.progress>1/4?He(!1):da()),P.value=null,M.value=null)},ya=e=>{z.value=!0,be(e.changedTouches[0])},Ma=e=>{we(e.changedTouches[0])&&e.preventDefault()},Ye=e=>{ye(e.changedTouches[0])},Ia=e=>{if(m.value=!0,!z.value&&!(e.which&&e.which!==1)){be(e);try{e.target.setPointerCapture(e.pointerId)}catch{}}},za=e=>{z.value||we(e)},Se=e=>{if(!z.value){ye(e);try{e.target.releasePointerCapture(e.pointerId)}catch{}}},ka=e=>{z.value||m.value||e.which&&e.which!==1||be(e)},xa=e=>{(!z.value||!m.value)&&we(e)},Pa=e=>{(!z.value||!m.value)&&ye(e)},We=e=>{e===null||e===re.value||(i.value=a.pages[0]===null&&r.value===2&&e===1?0:e-1,D.value=1/0,T.value=-1/0,L.value=ne.value)};return j(i,()=>{f.value=i.value,I.value=i.value+1,U()}),j(ne,()=>{if(q.value)return;const e=()=>{requestAnimationFrame(()=>{const l=ne.value-L.value;Math.abs(l)<.5?(L.value=ne.value,q.value=!1):(L.value+=l*.1,e())})};q.value=!0,e()}),j(a.pages,(e,l)=>{Be(),!(l!=null&&l.length)&&e!=null&&e.length&&a.startPage>1&&e[0]==null&&i.value++}),j(a.startPage,e=>{We(e)}),(e,l)=>(ee(),G("div",el,[qa(e.$slots,"default",Ha(Ya({canFlipLeft:ue.value,canFlipRight:oe.value,canZoomIn:N(V),canZoomOut:N(le),page:re.value,numPages:ea.value,flipLeft:Re,flipRight:Ze,zoomIn:N(te),zoomOut:N(W)}))),S("div",{ref_key:"refViewport",ref:$,class:Ee(["viewport",Qe.value]),style:X(Ge.value),onTouchmove:Ma,onPointermove:za,onMousemove:xa,onTouchend:Ye,onTouchcancel:Ye,onPointerup:Se,onPointercancel:Se,onMouseup:Pa,onWheel:l[2]||(l[2]=n=>N(Je)(n,z.value))},[S("div",{class:"flipbook-container",style:X({transform:`scale(${N(y)})`})},[S("div",{class:"click-to-flip left",style:X({cursor:ue.value?"pointer":"auto"}),onClick:Re},null,4),S("div",{class:"click-to-flip right",style:X({cursor:oe.value?"pointer":"auto"}),onClick:Ze},null,4),S("div",{style:X({transform:`translateX(${J.value}px)`})},[aa.value?(ee(),G("img",{key:0,class:"page fixed",style:X({width:x.value+"px",height:Z.value+"px",left:R.value+"px",top:H.value+"px"}),src:N(pe)(he.value,!0),onLoad:l[0]||(l[0]=n=>N(Le)(n))},null,44,al)):je("",!0),la.value?(ee(),G("img",{key:1,class:"page fixed",style:X({width:x.value+"px",height:Z.value+"px",left:g.value/2+"px",top:H.value+"px"}),src:N(pe)(me.value,!0),onLoad:l[1]||(l[1]=n=>N(Le)(n))},null,44,ll)):je("",!0),S("div",{style:X({opacity:o.opacity})},[(ee(!0),G(Sa,null,Wa(ra.value,([n,s,w,d,k,ve])=>(ee(),G("div",{key:n,class:Ee(["polygon",{blank:!s}]),style:X({backgroundImage:s&&`url(${N(Ke)(s)})`,backgroundSize:oa.value,backgroundPosition:d,width:ta.value,height:ua.value,transform:k,zIndex:ve})},[Oa(S("div",{class:"lighting",style:X({backgroundImage:w})},null,4),[[Ca,w.length]])],6))),128))],4),S("div",{class:"bounding-box",style:X({left:Y.value+"px",top:H.value+"px",width:_.value-Y.value+"px",height:Z.value+"px",cursor:Xe.value}),onTouchstart:ya,onPointerdown:Ia,onMousedown:ka},null,36)],4)],4)],38)]))}};export{ul as n};
