import{d as Ba,b as h,r as Za,e as c,o as qa,f as Ha,w as j,g as G,j as ee,k as Ra,n as Ca,l as Sa,u as F,m as S,p as N,q as je,F as Wa,s as Ya,t as Ee,v as Oa,x as ja}from"./vue.esm-bundler-pap1KXlj.js";/*! @license Rematrix v0.7.2

	Copyright 2021 Julian Lloyd.

	Permission is hereby granted, free of charge, to any person obtaining a copy
	of this software and associated documentation files (the "Software"), to deal
	in the Software without restriction, including without limitation the rights
	to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
	copies of the Software, and to permit persons to whom the Software is
	furnished to do so, subject to the following conditions:

	The above copyright notice and this permission notice shall be included in
	all copies or substantial portions of the Software.

	THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
	IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
	FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
	AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
	LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
	OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
	THE SOFTWARE.
*/function ke(t){if(t&&t.constructor===Array){var u=t.filter(function(a){return typeof a=="number"}).filter(function(a){return!isNaN(a)});if(t.length===6&&u.length===6){var v=E();return v[0]=u[0],v[1]=u[1],v[4]=u[2],v[5]=u[3],v[12]=u[4],v[13]=u[5],v}else if(t.length===16&&u.length===16)return t}throw new TypeError("Expected a `number[]` with length 6 or 16.")}function E(){for(var t=[],u=0;u<16;u++)u%5==0?t.push(1):t.push(0);return t}function Ea(t,u){for(var v=ke(t),a=ke(u),g=[],p=0;p<4;p++)for(var n=[v[p],v[p+4],v[p+8],v[p+12]],i=0;i<4;i++){var f=i*4,I=[a[f],a[f+1],a[f+2],a[f+3]],P=n[0]*I[0]+n[1]*I[1]+n[2]*I[2]+n[3]*I[3];g[p+f]=P}return g}function Va(t){var u=E();return u[11]=-1/t,u}function Ua(t){var u=Math.PI/180*t,v=E();return v[0]=v[10]=Math.cos(u),v[2]=v[8]=Math.sin(u),v[2]*=-1,v}function _a(t){return"matrix3d("+ke(t).join(", ")+")"}function Ja(t,u){var v=E();return v[12]=t,u&&(v[13]=u),v}function Ka(t,u,v){var a=E();return t!==void 0&&u!==void 0&&v!==void 0&&(a[12]=t,a[13]=u,a[14]=v),a}class xe{constructor(u){u?u.m?this.m=[...u.m]:this.m=[...u]:this.m=E()}clone(){return new xe(this)}multiply(u){this.m=Ea(this.m,u)}perspective(u){this.multiply(Va(u))}transformX(u){return(u*this.m[0]+this.m[12])/(u*this.m[3]+this.m[15])}translate(u,v){this.multiply(Ja(u,v))}translate3d(u,v,a){this.multiply(Ka(u,v,a))}rotateY(u){this.multiply(Ua(u))}toString(){return _a(this.m)}}const Qa=(t,u,v)=>{let a=0;return t>.5&&(a=-(t-.5)*2*180),u==="left"&&(a=-a),v==="back"&&(a+=180),a},Ve=t=>Math.pow(t,2),Ga=t=>1-Ve(1-t),Ue=t=>t<.5?Ve(t*2)/2:.5+Ga((t-.5)*2)/2;function _e(t,u,v,a){const g=h(1),p=h(0),n=h(!1),i=h(0),f=h(0),I=(m=null)=>{M.value&&(p.value+=1,B(t.zooms[p.value],m))},P=(m=null)=>{z.value&&(p.value-=1,B(t.zooms[p.value],m))},B=(m,D=null)=>{const T=v.value;let $,o;if(D){const W=T.getBoundingClientRect();$=D.pageX-W.left,o=D.pageY-W.top}else $=T.clientWidth/2,o=T.clientHeight/2;const L=g.value,H=m,Y=T.scrollLeft,O=T.scrollTop,V=$+Y,y=o+O,ae=V/L*H-$,U=y/L*H-o,le=Date.now();n.value=!0,u("zoom-start",m);const te=()=>{requestAnimationFrame(()=>{const W=Date.now()-le;let X=W/t.zoomDuration;X=X>1||X,X=Ue(X),g.value=L+(H-L)*X,i.value=Y+(ae-Y)*X,f.value=O+(U-O)*X,W<t.zoomDuration?te():(u("zoom-end",m),n.value=!1,g.value=m,i.value=ae,f.value=U)})};te(),H>1&&a(!0)},b=m=>{p.value=(p.value+1)%t.zooms.length,B(t.zooms[p.value],m)},M=c(()=>!n.value&&p.value<t.zooms.length-1),z=c(()=>!n.value&&p.value>0);return{zoom:g,zooming:n,canZoomIn:M,canZoomOut:z,zoomIn:I,zoomOut:P,zoomAt:b,onWheel:(m,D)=>{t.wheel==="scroll"&&g.value>1&&!D.value&&(i.value=v.value.scrollLeft+m.deltaX,f.value=v.value.scrollTop+m.deltaY,m.cancelable&&m.preventDefault()),t.wheel==="zoom"&&(m.deltaY>=100?(P(m),m.preventDefault()):m.deltaY<=-100&&(I(m),m.preventDefault()))},scrollLeft:i,scrollTop:f}}function el(t,u){const{zoom:v,zooming:a}=_e(t),g=h({}),p=h(0),n=h(0),i=h(null),f=h(),I=h(),P=(b,M=!1)=>M&&v.value>1&&!a.value?t.pagesHiRes[b]||null:t.pages[b]||null,B=b=>{if(f.value===null||g.value[b])return b;{const M=new Image;return M.onload=()=>{g.value[b]=!0},M.src=b,t.loadingImage}};return{imageWidth:f,imageHeight:I,pageUrl:P,loadImage:B,pageUrlLoading:(b,M=!1)=>{const z=P(b,M);return M&&v.value>1&&!a.value?z:z&&B(z)},onImageLoad:(b,M)=>{p.value=0,n.value=b,i.value=M},didLoadImage:b=>{f.value===null&&(f.value=(b.target||b.path[0]).naturalWidth,I.value=(b.target||b.path[0]).naturalHeight,u()),i.value&&++p.value>=n.value&&(i.value(),i.value=null)}}}const al={pages:{type:Array,required:!0},pagesHiRes:{type:Array,default:()=>[]},flipDuration:{type:Number,default:1e3},zoomDuration:{type:Number,default:500},zooms:{type:Array,default:()=>[1,2,4]},perspective:{type:Number,default:2400},nPolygons:{type:Number,default:10},ambient:{type:Number,default:.4},gloss:{type:Number,default:.6},swipeMin:{type:Number,default:3},singlePage:{type:Boolean,default:!1},forwardDirection:{validator:t=>t==="right"||t==="left",default:"right"},centering:{type:Boolean,default:!0},startPage:{type:Number,default:null},loadingImage:{type:String,default:"spinner"},clickToZoom:{type:Boolean,default:!0},dragToFlip:{type:Boolean,default:!0},wheel:{type:String,default:"scroll"}},ll={class:"vue3-flipbook"},tl=["src"],ul=["src"],rl=Ba({__name:"Flipbook",props:al,emits:["flip-left-start","flip-left-end","flip-right-start","flip-right-end","zoom-start","zoom-end"],setup(t,{emit:u}){const v=u,a=t,g=h(0),p=h(0),n=h(1),i=h(0),f=h(0),I=h(1),P=h(null),B=h(null),b=h(0),M=h(null),z=h(!1),m=h(!1),D=h(1/0),T=h(-1/0),$=h(null),o=Za({progress:0,direction:null,frontImage:null,backImage:null,auto:!1,opacity:1}),L=h(null),H=h(!1),Y=h(0),O=h(0),V=(e=!1)=>{for(let l=i.value-3;l<=i.value+3;l++)pe(l);if(e)for(let l=i.value;l<i.value+n.value;l++){const r=a.pagesHiRes[l];r&&typeof r=="string"&&(new Image().src=r)}},{zoom:y,zooming:ae,canZoomIn:U,canZoomOut:le,zoomIn:te,zoomOut:W,zoomAt:X,onWheel:Je,scrollLeft:Pe,scrollTop:De}=_e(a,v,$,V),{imageWidth:ge,imageHeight:Te,pageUrl:A,loadImage:Ke,pageUrlLoading:pe,onImageLoad:$e,didLoadImage:Le}=el(a,V),Qe=c(()=>({zoom:ae.value||y.value>1,"drag-to-scroll":!z.value})),Ge=c(()=>({cursor:Ne.value=="grabbing"?"grabbing":"auto"})),ue=c(()=>a.forwardDirection==="left"?Ae.value:Fe.value),oe=c(()=>a.forwardDirection==="right"?Ae.value:Fe.value),ea=c(()=>a.pages[0]===null?a.pages.length-1:a.pages.length),re=c(()=>a.pages[0]!==null?i.value+1:Math.max(1,i.value)),Ae=c(()=>!o.direction&&i.value<a.pages.length-n.value),Fe=c(()=>!o.direction&&i.value>=n.value&&!(n.value===1&&!A(f.value-1))),he=c(()=>a.forwardDirection==="right"||n.value===1?f.value:I.value),me=c(()=>a.forwardDirection==="right"||n.value===1?I.value:f.value),aa=c(()=>A(he.value)),la=c(()=>A(me.value)&&n.value===2),Ne=c(()=>M.value?M.value:a.clickToZoom&&U.value?"zoom-in":a.clickToZoom&&le.value?"zoom-out":a.dragToFlip?"grab":"auto"),Z=c(()=>(g.value-x.value*n.value)/2),R=c(()=>(p.value-q.value)/2),ta=c(()=>{let e=x.value/a.nPolygons;return e=Math.ceil(e+1/y.value),e+"px"}),ua=c(()=>q.value+"px"),oa=c(()=>`${x.value}px ${q.value}px`),ra=c(()=>He("front").concat(He("back"))),C=c(()=>{if(n.value===1)return Z.value;{let e;return A(he.value)?e=Z.value:e=g.value/2,e<D.value?e:D.value}}),_=c(()=>{if(n.value===1)return g.value-Z.value;{let e=A(me.value)?g.value-Z.value:g.value/2;return e>T.value?e:T.value}}),ne=c(()=>{let e=a.centering?Math.round(g.value/2-(C.value+_.value)/2):0;return L.value===null&&ge.value!==null&&(L.value=e),e}),J=c(()=>Math.round(L.value)),na=c(()=>{let e=(_.value-C.value)*y.value;return e<g.value?(C.value+J.value)*y.value-(g.value-e)/2:(C.value+J.value)*y.value}),va=c(()=>{let e=(_.value-C.value)*y.value;return e<g.value?(C.value+J.value)*y.value-(g.value-e)/2:(_.value+J.value)*y.value-g.value}),ia=c(()=>{let e=q.value*y.value;return e<p.value?R.value*y.value-(p.value-e)/2:R.value*y.value}),sa=c(()=>{let e=q.value*y.value;return e<p.value?R.value*y.value-(p.value-e)/2:(R.value+q.value)*y.value-p.value});qa(()=>{window.addEventListener("resize",de,{passive:!0}),de(),y.value=a.zooms[0],We(a.startPage)}),Ha(()=>{window.removeEventListener("resize",de,{passive:!0})});const Xe=c(()=>{const e=g.value/n.value/ge.value,l=p.value/Te.value,r=e<l?e:l;return r<1?r:1}),x=c(()=>Math.round(ge.value*Xe.value)),q=c(()=>Math.round(Te.value*Xe.value)),de=()=>{const e=$.value;e&&(g.value=e.clientWidth,p.value=e.clientHeight,n.value=g.value>p.value&&!a.singlePage?2:1,n.value===2&&(i.value&=-2),Be(),D.value=1/0,T.value=-1/0)},Be=()=>{n.value===1&&i.value===0&&a.pages.length&&!A(0)&&i.value++},Ze=()=>{ue.value&&fe("left",!0)},qe=()=>{oe.value&&fe("right",!0)},ca=(e,l)=>{let r=Z.value,s=!1;return n.value===1?a.forwardDirection==="right"?e==="back"&&(s=!0,r=Z.value-x.value):l==="left"?e==="back"?r=x.value-Z.value:s=!0:e==="front"?r=x.value-Z.value:s=!0:l==="left"?e==="back"?r=g.value/2:s=!0:e==="front"?r=g.value/2:s=!0,{pageX:r,originRight:s}},ga=(e,l,r)=>{const s=new xe;return s.translate(g.value/2),s.perspective(a.perspective),s.translate(-g.value/2),s.translate(e,R.value),r&&(l&&s.translate(x.value),s.rotateY(r),l&&s.translate(-x.value)),s},pa=e=>{let l;e<.5?l=e*2*Math.PI:l=(1-(e-.5)*2)*Math.PI,l==0&&(l=1e-9);const r=x.value/l;return{theta:l,radius:r}},ha=(e,l,r,s)=>{let w=Math.sin(e)*l;r&&(w=x.value-w);let d=(1-Math.cos(e))*l;return s==="back"&&(d=-d),{x:w,z:d}},He=e=>{if(!o.direction)return[];let l=o.progress,r=o.direction;n.value===1&&r!==a.forwardDirection&&(l=1-l,r=a.forwardDirection),o.opacity=n.value===1&&l>.7?1-(l-.7)/.3:1;let s=e==="front"?o.frontImage:o.backImage;const w=x.value/a.nPolygons,{pageX:d,originRight:k}=ca(e,r),ve=Qa(l,r,e),Da=ga(d,k,ve),{theta:Me,radius:Ta}=pa(l);let Ie=0,ie=Me/a.nPolygons,K=k?-Me/Math.PI*180+ie/2/Math.PI*180:ie/2/Math.PI*180,se=ie/Math.PI*180;e==="back"&&(K=-K,se=-se),D.value=1/0,T.value=-1/0;const Ye=[],ze=[];for(let ce=0;ce<a.nPolygons;ce++){const $a=`${ce/(a.nPolygons-1)*100}% 0px`,Q=Da.clone(),La=k?Me-Ie:Ie,{x:Aa,z:Oe}=ha(La,Ta,k,e);Q.translate3d(Aa,0,Oe),Q.rotateY(-K);const Fa=Q.transformX(0),Na=Q.transformX(w);ze.push(Fa,Na);const Xa=ma(ve-K,se);Ie+=ie,K+=se,Ye.push([`${e}${ce}`,s,Xa,$a,Q.toString(),Math.abs(Math.round(Oe))])}return T.value=Math.max(...ze),D.value=Math.min(...ze),Ye},ma=(e,l)=>{const r=[],s=[-.5,-.25,0,.25,.5];if(a.ambient<1){const w=1-a.ambient,d=s.map(k=>(1-Math.cos((e-l*k)/180*Math.PI))*w);r.push(`linear-gradient(to right, rgba(0, 0, 0, ${d[0]}), rgba(0, 0, 0, ${d[1]}) 25%, rgba(0, 0, 0, ${d[2]}) 50%, rgba(0, 0, 0, ${d[3]}) 75%, rgba(0, 0, 0, ${d[4]}))`)}if(a.gloss>0){const w=s.map(d=>Math.max(Math.cos((e+30-l*d)/180*Math.PI)**200,Math.cos((e-30-l*d)/180*Math.PI)**200));r.push(`linear-gradient(to right, rgba(255, 255, 255, ${w[0]*a.gloss}), rgba(255, 255, 255, ${w[1]*a.gloss}) 25%, rgba(255, 255, 255, ${w[2]*a.gloss}) 50%, rgba(255, 255, 255, ${w[3]*a.gloss}) 75%, rgba(255, 255, 255, ${w[4]*a.gloss}))`)}return r.join(",")},fe=(e,l)=>{e!==a.forwardDirection?n.value===1?(o.frontImage=A(i.value-1),o.backImage=null):(o.frontImage=A(f.value),o.backImage=A(i.value-n.value+1)):n.value===1?(o.frontImage=A(i.value),o.backImage=null):(o.frontImage=A(I.value),o.backImage=A(i.value+n.value)),o.direction=e,o.progress=0,requestAnimationFrame(()=>{requestAnimationFrame(()=>{o.direction!==a.forwardDirection?n.value===2&&(f.value=i.value-n.value):n.value===1?f.value=i.value+n.value:I.value=i.value+1+n.value,l&&Re(!0)})})},Re=e=>{const l=Date.now(),r=a.flipDuration*(1-o.progress),s=o.progress;o.auto=!0,v(`flip-${o.direction}-start`,re.value);const w=()=>{const d=Date.now()-l;let k=s+d/r;k=k>1?1:k,o.progress=e?Ue(k):k,k<1?requestAnimationFrame(w):(o.direction!==a.forwardDirection?i.value-=n.value:i.value+=n.value,v(`flip-${o.direction}-end`,re.value),n.value===1&&o.direction===a.forwardDirection?o.direction=null:$e(1,()=>{o.direction=null}),o.auto=!1)};w()},da=()=>{const e=Date.now(),l=a.flipDuration*o.progress,r=o.progress;o.auto=!0;const s=()=>{requestAnimationFrame(()=>{const w=Date.now()-e;let d=r-r*w/l;d=d<0?0:d,o.progress=d,d>0?s():(f.value=i.value,I.value=i.value+1,n.value===1&&o.direction!==a.forwardDirection?o.direction=null:$e(1,()=>{o.direction=null}),o.auto=!1)})};s()},fa=(e,l)=>{Pe.value=Y.value-e,De.value=O.value-l},ba=c(()=>Math.min(va.value,Math.max(na.value,Pe.value))),wa=c(()=>Math.min(sa.value,Math.max(ia.value,De.value)));j(ba,e=>{$.value.scrollLeft=e}),j(wa,e=>{$.value.scrollTop=e});const be=e=>{P.value=e.pageX,B.value=e.pageY,b.value=0,y.value<=1?a.dragToFlip&&(M.value="grab"):(Y.value=$.value.scrollLeft,O.value=$.value.scrollTop,M.value="all-scroll")},we=e=>{if(!P.value)return;const l=e.pageX-P.value,r=e.pageY-B.value;if(b.value=Math.max(b.value,Math.abs(l),Math.abs(r)),y.value>1){fa(l,r);return}if(!a.dragToFlip||Math.abs(r)>Math.abs(l))return;M.value="grabbing";const s=l>0?"left":"right",w=l>0?ue.value:oe.value,d=l>0?a.swipeMin:-a.swipeMin;return o.direction===null&&w&&l>=d&&fe(s,!1),o.direction===s&&(o.progress=Math.abs(l)/x.value,o.progress>1&&(o.progress=1)),!0},ye=e=>{P.value&&(a.clickToZoom&&b.value<a.swipeMin&&X(e),o.direction!==null&&!o.auto&&(o.progress>1/4?Re(!1):da()),P.value=null,M.value=null)},ya=e=>{z.value=!0,be(e.changedTouches[0])},Ma=e=>{we(e.changedTouches[0])&&e.preventDefault()},Ce=e=>{ye(e.changedTouches[0])},Ia=e=>{if(m.value=!0,!z.value&&!(e.which&&e.which!==1)){be(e);try{e.target.setPointerCapture(e.pointerId)}catch{}}},za=e=>{z.value||we(e)},Se=e=>{if(!z.value){ye(e);try{e.target.releasePointerCapture(e.pointerId)}catch{}}},ka=e=>{z.value||m.value||e.which&&e.which!==1||be(e)},xa=e=>{(!z.value||!m.value)&&we(e)},Pa=e=>{(!z.value||!m.value)&&ye(e)},We=e=>{e===null||e===re.value||(i.value=a.pages[0]===null&&n.value===2&&e===1?0:e-1,D.value=1/0,T.value=-1/0,L.value=ne.value)};return j(i,()=>{f.value=i.value,I.value=i.value+1,V()}),j(ne,()=>{if(H.value)return;const e=()=>{requestAnimationFrame(()=>{const l=ne.value-L.value;Math.abs(l)<.5?(L.value=ne.value,H.value=!1):(L.value+=l*.1,e())})};H.value=!0,e()}),j(a.pages,(e,l)=>{Be(),!(l!=null&&l.length)&&e!=null&&e.length&&a.startPage>1&&e[0]==null&&i.value++}),j(a.startPage,e=>{We(e)}),(e,l)=>(G(),ee("div",ll,[Ra(e.$slots,"default",Ca(Sa({canFlipLeft:ue.value,canFlipRight:oe.value,canZoomIn:F(U),canZoomOut:F(le),page:re.value,numPages:ea.value,flipLeft:Ze,flipRight:qe,zoomIn:F(te),zoomOut:F(W)}))),S("div",{ref_key:"refViewport",ref:$,class:Ee(["viewport",Qe.value]),style:N(Ge.value),onTouchmove:Ma,onPointermove:za,onMousemove:xa,onTouchend:Ce,onTouchcancel:Ce,onPointerup:Se,onPointercancel:Se,onMouseup:Pa,onWheel:l[2]||(l[2]=r=>F(Je)(r,z.value))},[S("div",{class:"flipbook-container",style:N({transform:`scale(${F(y)})`})},[S("div",{class:"click-to-flip left",style:N({cursor:ue.value?"pointer":"auto"}),onClick:Ze},null,4),S("div",{class:"click-to-flip right",style:N({cursor:oe.value?"pointer":"auto"}),onClick:qe},null,4),S("div",{style:N({transform:`translateX(${J.value}px)`})},[aa.value?(G(),ee("img",{key:0,class:"page fixed",style:N({width:x.value+"px",height:q.value+"px",left:Z.value+"px",top:R.value+"px"}),src:F(pe)(he.value,!0),onLoad:l[0]||(l[0]=r=>F(Le)(r))},null,44,tl)):je("",!0),la.value?(G(),ee("img",{key:1,class:"page fixed",style:N({width:x.value+"px",height:q.value+"px",left:g.value/2+"px",top:R.value+"px"}),src:F(pe)(me.value,!0),onLoad:l[1]||(l[1]=r=>F(Le)(r))},null,44,ul)):je("",!0),S("div",{style:N({opacity:o.opacity})},[(G(!0),ee(Wa,null,Ya(ra.value,([r,s,w,d,k,ve])=>(G(),ee("div",{key:r,class:Ee(["polygon",{blank:!s}]),style:N({backgroundImage:s&&`url(${F(Ke)(s)})`,backgroundSize:oa.value,backgroundPosition:d,width:ta.value,height:ua.value,transform:k,zIndex:ve})},[Oa(S("div",{class:"lighting",style:N({backgroundImage:w})},null,4),[[ja,w.length]])],6))),128))],4),S("div",{class:"bounding-box",style:N({left:C.value+"px",top:R.value+"px",width:_.value-C.value+"px",height:q.value+"px",cursor:Ne.value}),onTouchstart:ya,onPointerdown:Ia,onMousedown:ka},null,36)],4)],4)],38)]))}});export{rl as u};
